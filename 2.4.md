# 2.4 å¯å˜æ•°æ®

> æ¥æºï¼š[2.4   Mutable Data](http://composingprograms.com/pages/24-mutable-data.html)



æˆ‘ä»¬å·²ç»çœ‹åˆ°æŠ½è±¡åœ¨å¸®åŠ©æˆ‘ä»¬åº”å¯¹å¤§å‹ç³»ç»Ÿçš„å¤æ‚æ€§æ–¹é¢æ˜¯å¤šä¹ˆé‡è¦ã€‚æœ‰æ•ˆçš„ç¼–ç¨‹è¿˜éœ€è¦å¯ä»¥æŒ‡å¯¼æˆ‘ä»¬åˆ¶å®šç¨‹åºæ€»ä½“è®¾è®¡çš„ç»„ç»‡åŸåˆ™ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç­–ç•¥æ¥å¸®åŠ©æˆ‘ä»¬æ„å»ºæ¨¡å—åŒ–çš„å¤§å‹ç³»ç»Ÿï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥è‡ªç„¶åœ°åˆ†æˆå¯ä»¥å•ç‹¬å¼€å‘å’Œç»´æŠ¤çš„è¿è´¯éƒ¨åˆ†ã€‚

åˆ›å»ºæ¨¡å—åŒ–ç¨‹åºçš„ä¸€é¡¹å¼ºå¤§æŠ€æœ¯æ˜¯åˆå¹¶å¯èƒ½ä¼šéšæ—¶é—´æ”¹å˜çŠ¶æ€çš„æ•°æ®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå•ä¸ªæ•°æ®å¯¹è±¡å¯ä»¥ä»£è¡¨ç‹¬ç«‹äºç¨‹åºå…¶ä½™éƒ¨åˆ†å‘å±•çš„ä¸œè¥¿ã€‚ä¸€ä¸ªä¸æ–­å˜åŒ–çš„å¯¹è±¡çš„è¡Œä¸ºå¯èƒ½ä¼šå—åˆ°å…¶å†å²çš„å½±å“ï¼Œå°±åƒä¸–ç•Œä¸Šçš„ä¸€ä¸ªå®ä½“ä¸€æ ·ã€‚å‘æ•°æ®æ·»åŠ çŠ¶æ€æ˜¯ç§°ä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼çš„æ ¸å¿ƒè¦ç´ 



## 2.1.1 å¯¹è±¡éšå–»

åœ¨æœ¬æ–‡çš„å¼€å§‹ï¼Œæˆ‘ä»¬åŒºåˆ†äº†å‡½æ•°å’Œæ•°æ®ï¼šå‡½æ•°æ‰§è¡Œæ“ä½œï¼Œè€Œæ•°æ®è¢«æ“ä½œã€‚å½“æˆ‘ä»¬åœ¨æ•°æ®ä¸­åŒ…å«å‡½æ•°å€¼æ—¶ï¼Œæˆ‘ä»¬æ‰¿è®¤æ•°æ®ä¹Ÿå¯ä»¥æ‹¥æœ‰è¡Œä¸ºã€‚å‡½æ•°å¯ä»¥ä½œä¸ºæ•°æ®è¿›è¡Œæ“ä½œï¼Œä½†ä¹Ÿå¯ä»¥è¢«è°ƒç”¨æ¥æ‰§è¡Œè®¡ç®—ã€‚

å¯¹è±¡å°†æ•°æ®å€¼ä¸è¡Œä¸ºç›¸ç»“åˆã€‚ å¯¹è±¡ä»£è¡¨ä¿¡æ¯ï¼Œä½†ä¹Ÿè¡¨ç°å¾—åƒå®ƒä»¬æ‰€ä»£è¡¨çš„äº‹ç‰©ã€‚ å¯¹è±¡å¦‚ä½•ä¸å…¶ä»–å¯¹è±¡äº¤äº’çš„é€»è¾‘ä¸ç¼–ç å¯¹è±¡å€¼çš„ä¿¡æ¯æ†ç»‘åœ¨ä¸€èµ·ã€‚ å½“ä¸€ä¸ªå¯¹è±¡è¢«æ‰“å°å‡ºæ¥æ—¶ï¼Œå®ƒçŸ¥é“å¦‚ä½•åœ¨æ–‡æœ¬ä¸­æŠŠè‡ªå·±æ‹¼å†™å‡ºæ¥ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯ç”±éƒ¨åˆ†ç»„æˆçš„ï¼Œå®ƒå°±çŸ¥é“å¦‚ä½•æŒ‰éœ€æ˜¾ç¤ºè¿™äº›éƒ¨åˆ†ã€‚ å¯¹è±¡æ—¢æ˜¯ä¿¡æ¯åˆæ˜¯è¿‡ç¨‹ï¼Œå®ƒä»¬æ†ç»‘åœ¨ä¸€èµ·ä»¥è¡¨ç¤ºå¤æ‚äº‹ç‰©çš„å±æ€§ã€äº¤äº’å’Œè¡Œä¸ºã€‚

å¯¹è±¡è¡Œä¸ºåœ¨ Python ä¸­é€šè¿‡ä¸“é—¨çš„å¯¹è±¡è¯­æ³•å’Œç›¸å…³æœ¯è¯­æ¥å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¤ºä¾‹è¿›è¡Œä»‹ç»ã€‚ æ—¥æœŸï¼ˆ`date`ï¼‰æ˜¯ä¸€ç§å¯¹è±¡ 

```python
>>> from datetime import date
```

`date`çš„åå­—ç»‘å®šåˆ°äº†ä¸€ä¸ªç±»ä¸Šé¢ã€‚ç±»è¡¨ç¤ºä¸€ç±»å€¼ã€‚å•ä¸ªæ—¥æœŸå«åšè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡ç”¨å‚æ•°è°ƒç”¨è¿™ä¸ªç±»æ¥æ„é€ ï¼Œè¿™äº›å‚æ•°æè¿°äº†å®ä¾‹ã€‚


```python
>>> tues = date(2014, 5, 13)
```

è™½ç„¶`tues`æ˜¯ç”±åŸºæœ¬æ•°å€¼æ„é€ çš„ï¼Œä½†å®ƒçš„è¡Œä¸ºå°±åƒä¸€ä¸ªæ—¥æœŸé‚£æ ·ã€‚ä¾‹å¦‚ï¼Œå°†å®ƒä¸å¦ä¸€ä¸ªæ—¥æœŸç›¸å‡ä¼šå¾—åˆ°æ—¶é—´å·®ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°å‡ºæ¥ã€‚

```py
>>> print(date(2014, 5, 19) - tues)
6 days, 0:00:00
```

å¯¹è±¡æ‹¥æœ‰å±æ€§ï¼Œå®ƒä»¬æ˜¯å¸¦æœ‰åå­—çš„å€¼ï¼Œä¹Ÿæ˜¯å¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚Python ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç‚¹è¿ç®—ç¬¦æ¥è®¿é—®å¯¹è±¡å±æ€§ï¼š

```
<expression> . <name>
```

ä¸Šé¢çš„`<expression>`è®¡ç®—ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œ`<name>`æ˜¯å¯¹è±¡çš„æŸä¸ªå±æ€§çš„åç§°ã€‚

ä¸åƒæˆ‘ä»¬ä¹‹å‰è§è¿‡çš„åç§°ï¼Œè¿™äº›å±æ€§åç§°åœ¨ä¸€èˆ¬çš„ç¯å¢ƒä¸­ä¸å¯ç”¨ã€‚åä¹‹ï¼Œå±æ€§åç§°æ˜¯ç‚¹è¿ç®—ç¬¦ä¹‹å‰çš„å¯¹è±¡å®ä¾‹çš„ç‰¹å®šéƒ¨åˆ†ã€‚

```python
>>> tues.year
2014
```

å¯¹è±¡ä¹Ÿæ‹¥æœ‰æ–¹æ³•ï¼Œå®ƒæ˜¯å€¼ä¸ºå‡½æ•°çš„å±æ€§ã€‚æ¯”å–»åœ°è¯´ï¼Œæˆ‘ä»¬è¯´å¯¹è±¡â€œçŸ¥é“â€å¦‚ä½•æ‰§è¡Œè¿™äº›æ–¹æ³•ã€‚æ–¹æ³•æ˜¯æ ¹æ®å‚æ•°å’Œå¯¹è±¡è®¡ç®—ç»“æœçš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œ`tues`çš„`strftime`æ–¹æ³•ï¼ˆï¼ˆä¸€ä¸ªç»å…¸çš„å‡½æ•°åç§°ï¼Œå…³äºâ€œæ—¶é—´çš„å­—ç¬¦ä¸²æ ¼å¼â€ï¼‰ï¼‰å•ä¸ªå‚æ•°æ¥æŒ‡å®šå¦‚ä½•æ˜¾ç¤ºæ—¥æœŸï¼ˆä¾‹å¦‚ï¼Œ%A æ„å‘³ç€åº”è¯¥å®Œæ•´åœ°æ˜¾ç¤ºæ˜ŸæœŸå‡ ï¼‰

```python
>>> tues.strftime('%A, %B %d')
'Tuesday, May 13'
```

è®¡ç®—`strftime`çš„è¿”å›å€¼éœ€è¦ä¸¤ä¸ªè¾“å…¥ï¼šæè¿°è¾“å‡ºæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä»¥åŠç»‘å®šåˆ°`tues`çš„æ—¥æœŸä¿¡æ¯ã€‚è¿™ä¸ªæ–¹æ³•ä½¿ç”¨æ—¥æœŸç‰¹å®šçš„é€»è¾‘æ¥äº§ç”Ÿç»“æœã€‚æˆ‘ä»¬ä»ä¸ä¼šè¯´2014 å¹´ 5 æœˆ 13 æ—¥æ˜¯æ˜ŸæœŸäºŒï¼Œä½†æ˜¯çŸ¥é“ä¸€ä¸ªäººçš„å·¥ä½œæ—¥æ˜¯æ—¥æœŸçš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡å°†è¡Œä¸ºå’Œä¿¡æ¯æ†ç»‘åœ¨ä¸€èµ·ï¼ŒPython å¯¹è±¡æä¾›äº†å¯é ã€ç‹¬ç«‹çš„æ—¥æœŸæŠ½è±¡ã€‚

æ—¥æœŸæ˜¯å¯¹è±¡ï¼Œä½†æ•°å­—ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨å’ŒèŒƒå›´ä¹Ÿæ˜¯å¯¹è±¡ã€‚ å®ƒä»¬ä»£è¡¨ä¸€ç§å€¼ï¼Œä½†ä¹Ÿè¦ä»¥é€‚åˆå®ƒä»¬ä»£è¡¨çš„å€¼çš„æ–¹å¼è¡Œäº‹ã€‚ å®ƒä»¬ä¹Ÿæœ‰å±æ€§å’Œæ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²å…·æœ‰ä¸€ç»„ä¾¿äºæ–‡æœ¬å¤„ç†çš„æ–¹æ³•ã€‚ ...

```python
>>> '1234'.isnumeric()
True
>>> 'rOBERT dE nIRO'.swapcase()
'Robert De Niro'
>>> 'eyes'.upper().endswith('YES')
True
```

å®é™…ä¸Šï¼ŒPython ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯å¯¹è±¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰å€¼éƒ½æœ‰è¡Œä¸ºå’Œå±æ€§ã€‚ ä»–ä»¬çš„è¡Œä¸ºå°±åƒä»–ä»¬æ‰€ä»£è¡¨çš„å€¼ã€‚



## 2.4.2  Sequence Objects

åŸºæœ¬å†…ç½®å€¼ï¼ˆä¾‹å¦‚æ•°å­—ï¼‰çš„å®ä¾‹æ˜¯ä¸å¯å˜çš„ã€‚ å€¼æœ¬èº«ä¸èƒ½åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­æ”¹å˜ã€‚ å¦ä¸€æ–¹é¢ï¼Œåˆ—è¡¨æ˜¯å¯å˜çš„ã€‚

å¯å˜å¯¹è±¡ç”¨äºè¡¨ç¤ºéšæ—¶é—´å˜åŒ–çš„å€¼ã€‚ ä¸€ä¸ªäººä»ä¸€å¤©åˆ°ä¸‹ä¸€å¤©éƒ½æ˜¯åŒä¸€ä¸ªäººï¼Œå°½ç®¡å˜è€ã€ç†å‘æˆ–ä»¥å…¶ä»–æ–¹å¼æ”¹å˜äº†ã€‚ ç±»ä¼¼åœ°ï¼Œç”±äºå˜å¼‚æ“ä½œï¼Œå¯¹è±¡å¯èƒ½å…·æœ‰ä¸æ–­å˜åŒ–çš„å±æ€§ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥æ›´æ”¹åˆ—è¡¨çš„å†…å®¹ã€‚ å¤§å¤šæ•°æ›´æ”¹æ˜¯é€šè¿‡è°ƒç”¨åˆ—è¡¨å¯¹è±¡ä¸Šçš„æ–¹æ³•æ¥æ‰§è¡Œçš„ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªè¯´æ˜æ‰‘å…‹ç‰Œå†å²çš„ä¾‹å­æ¥ä»‹ç»å¾ˆå¤šåˆ—è¡¨ä¿®æ”¹æ“ä½œã€‚ ç¤ºä¾‹ä¸­çš„æ³¨é‡Šæè¿°äº†æ¯ä¸ªæ–¹æ³•è°ƒç”¨çš„æ•ˆæœã€‚

> **åˆ—è¡¨çš„å…ƒç´ æ˜¯å¯ä¿®æ”¹çš„**(ä¿®æ”¹çš„æ˜¯å¼•ç”¨å˜é‡çš„å€¼)

æ‰‘å…‹ç‰Œæ˜¯åœ¨ä¸­å›½å‘æ˜çš„ï¼Œå¤§æ¦‚åœ¨ 9 ä¸–çºªå·¦å³ã€‚ æ—©æœŸçš„ç‰Œæœ‰æœ‰ä¸‰ç§èŠ±è‰²ï¼Œå¯¹åº”äºè´§å¸çš„é¢é¢ã€‚

```python
>>> chinese = ['coin', 'string', 'myriad']  # åˆ—è¡¨å­—é¢å€¼
>>> suits = chinese                         # ä¸¤ä¸ªåå­—æŒ‡çš„æ˜¯åŒä¸€ä¸ªåˆ—è¡¨
```

éšç€çº¸ç‰Œä¼ åˆ°æ¬§æ´²ï¼Œç‰Œåªå‰©ä¸€ç§äº†ã€‚

```python
>>> suits.pop()             #åˆ é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ 
'myriad'
>>> suits.remove('string')  # åˆ é™¤ä¸å‚æ•°ç›¸ç­‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
```

æ·»åŠ äº†å¦å¤–ä¸‰ç§èŠ±è‰²ï¼Œ

````python
>>> suits.append('cup')              # åœ¨æœ€åæ·»åŠ ä¸€ä¸ªå…ƒç´ 
>>> suits.extend(['sword', 'club'])  # å°†åºåˆ—çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æœ«å°¾
````

æ„å¤§åˆ©äººç§°ä¹‹ä¸ºå‰‘é»‘æ¡ƒ

```python
>>> suits[2] = 'spade'  # æ›¿æ¢ä¸€ä¸ªå…ƒç´ 
```

ä½¿ç”¨ä¼ ç»Ÿæ„å¤§åˆ©çº¸ç‰Œçš„èŠ±è‰²

```python
>>> suits
['coin', 'cup', 'spade', 'club']
```

ä»Šå¤©åœ¨ç¾å›½ä½¿ç”¨çš„æ³•å›½å˜ä½“æ”¹å˜äº†å‰ä¸¤ä¸¤èŠ±è‰²ï¼š

```python
>>> suits[0:2] = ['heart', 'diamond']  # Replace a slice
>>> suits
['heart', 'diamond', 'spade', 'club']
```

è¿˜å­˜åœ¨ç”¨äºæ’å…¥ã€æ’åºå’Œåè½¬åˆ—è¡¨çš„æ–¹æ³•ã€‚ æ‰€æœ‰è¿™äº›å˜å¼‚æ“ä½œéƒ½ä¼šæ”¹å˜åˆ—è¡¨çš„å€¼ï¼› å®ƒä»¬ä¸ä¼šåˆ›å»ºæ–°çš„åˆ—è¡¨å¯¹è±¡ã€‚

å…±äº«å’Œèº«ä»½:å› ä¸ºæˆ‘ä»¬ä¸€ç›´åœ¨æ›´æ”¹å•ä¸ªåˆ—è¡¨è€Œä¸æ˜¯åˆ›å»ºæ–°åˆ—è¡¨ï¼Œæ‰€ä»¥ç»‘å®šåˆ°åç§°` chinese` çš„å¯¹è±¡ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œå› ä¸ºå®ƒæ˜¯ç»‘å®šåˆ°`suits`çš„åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ï¼

```python
>>> chinese  # This name co-refers with "suits" to the same changing list
['heart', 'diamond', 'spade', 'club']
```

è¿™ç§è¡Œä¸ºæ˜¯æ–°çš„ã€‚ ä»¥å‰ï¼Œå¦‚æœåç§°æœªå‡ºç°åœ¨è¯­å¥ä¸­ï¼Œåˆ™å…¶å€¼ä¸ä¼šå—åˆ°è¯¥è¯­å¥çš„å½±å“ã€‚ å¯¹äºå¯å˜æ•°æ®ï¼Œè°ƒç”¨ä¸€ä¸ªåç§°çš„æ–¹æ³•å¯ä»¥åŒæ—¶å½±å“å¦ä¸€ä¸ªåç§°ã€‚

æ­¤ç¤ºä¾‹çš„ç¯å¢ƒå›¾æ˜¾ç¤ºäº†ç»‘å®šåˆ° `chinese` çš„å€¼å¦‚ä½•è¢«æ›´æ”¹çš„ã€‚ é€æ­¥æ‰§è¡Œä»¥ä¸‹ç¤ºä¾‹çš„æ¯ä¸€è¡Œä»¥è§‚å¯Ÿè¿™äº›æ›´æ”¹ã€‚

åœ¨[è¿è¡Œä¸‹é¢çš„ä»£ç ](https://pythontutor.com/composingprograms.html#mode=edit)ä»¥è·å¾—æ­¤ç¤ºä¾‹çš„ç¯å¢ƒå›¾ï¼Œå®ƒæ˜¾ç¤ºäº†ç»‘å®šåˆ° `chinese` çš„å€¼å¦‚ä½•è¢«æ›´æ”¹çš„ã€‚ é€æ­¥æ‰§è¡Œä»¥ä¸‹ç¤ºä¾‹çš„æ¯ä¸€è¡Œä»¥è§‚å¯Ÿè¿™äº›æ›´æ”¹ã€‚

```python
chinese = ['coin', 'string', 'myriad']
suits = chinese
suits.pop()
suits.remove('string')
suits.append('cup')
suits.extend(['sword', 'club'])
suits[2] = 'spade'
suits[0:2] = ['heart', 'diamond']
```

å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°`list`æ¥å¤åˆ¶åˆ—è¡¨ã€‚ å¯¹ä¸€ä¸ªåˆ—è¡¨çš„æ›´æ”¹ä¸ä¼šå½±å“å¦ä¸€ä¸ªåˆ—è¡¨ï¼Œé™¤éå®ƒä»¬å…±äº«ç»“æ„ã€‚

```python
>>> nest = list(suits)  # Bind "nest" to a second list with the same elements
>>> nest[0] = suits     # Create a nested list
```

æ ¹æ®è¿™ä¸ªç¯å¢ƒï¼Œæ”¹å˜`suits`å¼•ç”¨çš„åˆ—è¡¨ï¼Œä¼šå½±å“`nest`çš„ç¬¬ä¸€ä¸ªå…ƒç´ (åˆ—è¡¨)ï¼Œä½†ä¸ä¼šå½±å“å…¶ä»–å…ƒç´ ã€‚

```python
>>> suits.insert(2, 'Joker')  # Insert an element at index 2, shifting the rest
>>> nest
[['heart', 'diamond', 'Joker', 'spade', 'club'], 'diamond', 'spade', 'club']
```

åŒæ ·ï¼Œåœ¨` nest` çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸­æ’¤æ¶ˆæ­¤æ›´æ”¹ä¹Ÿä¼šæ›´æ”¹`suit`ã€‚

```python
>>> nest[0].pop(2)
'Joker'
>>> suits
['heart', 'diamond', 'spade', 'club']
```

åœ¨[è¿è¡Œä¸‹é¢çš„ä»£ç ](https://pythontutor.com/composingprograms.html#mode=edit)ä»¥è·å¾—æ­¤ç¤ºä¾‹çš„ç¯å¢ƒå›¾ï¼Œé€è¡Œæµè§ˆæ­¤ç¤ºä¾‹å°†æ˜¾ç¤ºåµŒå¥—åˆ—è¡¨çš„è¡¨ç¤ºã€‚

```python
suits = ['heart', 'diamond', 'spade', 'club']
nest = list(suits)
nest[0] = suits
suits.insert(2, 'Joker')
joke = nest[0].pop(2)
```

å› ä¸ºä¸¤ä¸ªåˆ—è¡¨å¯èƒ½æœ‰ç›¸åŒçš„å†…å®¹ä½†å®é™…ä¸Šæ˜¯ä¸åŒçš„åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥æµ‹è¯•ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚ Python åŒ…å«ä¸¤ä¸ªæ¯”è¾ƒè¿ç®—ç¬¦ï¼Œç§°ä¸º `is `å’Œ `is not`ï¼Œç”¨äºæµ‹è¯•ä¸¤ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šæ˜¯å¦è®¡ç®—ä¸ºç›¸åŒçš„å¯¹è±¡ã€‚ å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„å½“å‰å€¼ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”å¯¹ä¸€ä¸ªå¯¹è±¡çš„ä»»ä½•æ›´æ”¹éƒ½å°†å§‹ç»ˆåæ˜ åœ¨å¦ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚ èº«ä»½æ˜¯æ¯”`==`æ›´å¼ºçš„æ¡ä»¶ã€‚

> **is :ä¸è¦ç”¨äºå­—ç¬¦ä¸²å’Œæ•°å€¼**ï¼Œé™¤éä½ æœ‰æ˜ç¡®åœ°ç†ç”±å¦åˆ™åˆ«ç”¨

```python
>>> suits is nest[0]
True
>>> suits is ['heart', 'diamond', 'spade', 'club']
False
>>> suits == ['heart', 'diamond', 'spade', 'club']
True
```

æœ€åä¸¤ä¸ªæ¯”è¾ƒè¯´æ˜äº† `is` å’Œ `== `ä¹‹é—´çš„åŒºåˆ«ã€‚ å‰è€…æ£€æŸ¥èº«ä»½ï¼Œè€Œåè€…æ£€æŸ¥å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚

**åˆ—å‡ºç†è§£**ï¼šåˆ—è¡¨æ¨å¯¼å¼æ€»æ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°åˆ—è¡¨ã€‚ ä¾‹å¦‚ï¼Œ`unicodedata` æ¨¡å—è·Ÿè¸ª `Unicode` å­—æ¯è¡¨ä¸­æ¯ä¸ªå­—ç¬¦çš„æ­£å¼åç§°ã€‚ æˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾åç§°å¯¹åº”çš„å­—ç¬¦ï¼ŒåŒ…æ‹¬suitå¡ç‰‡çš„å­—ç¬¦ã€‚

```python
>>> from unicodedata import lookup
>>> [lookup('WHITE ' + s.upper() + ' SUIT') for s in suits]
['â™¡', 'â™¢', 'â™¤', 'â™§']
```

æ­¤ç»“æœåˆ—è¡¨ä¸ä¸`suit`å…±äº«å®ƒçš„ä»»ä½•å†…å®¹ï¼Œå¯¹ç»“æœåˆ—è¡¨çš„ä»»ä½•æ“ä½œéƒ½ä¸ä¼šå½±å“`suits`çš„å€¼ã€‚

æ‚¨å¯ä»¥åœ¨ Dive into Python 3 çš„ [Unicode](https://finderiko.com/python-book#one-ring-to-rule-them-all) éƒ¨åˆ†ä¸­é˜…è¯»æœ‰å…³ç”¨äºè¡¨ç¤ºæ–‡æœ¬çš„ Unicode æ ‡å‡†çš„æ›´å¤šä¿¡æ¯ã€‚

**å…ƒç»„**ï¼š å…ƒç»„æ˜¯å†…ç½®çš„ä¸€ç§ä¸å¯å˜çš„**åºåˆ—**ã€‚ å…ƒç»„æ˜¯ä½¿ç”¨å…ƒç»„å­—é¢é‡åˆ›å»ºçš„ï¼Œè¯¥å­—é¢é‡ç”¨é€—å·åˆ†éš”å…ƒç´ ã€‚ æ‹¬å·æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨å®è·µä¸­ç»å¸¸ä½¿ç”¨ã€‚ ä»»ä½•å¯¹è±¡éƒ½å¯ä»¥æ”¾åœ¨å…ƒç»„ä¸­ã€‚

```python
>>> 1, 2 + 3
(1, 5)
>>> ("the", 1, ("and", "only"))
('the', 1, ('and', 'only'))

>>> type( (10, 20) )
<class 'tuple'>
```

ç©ºå…ƒç»„å’Œå•å…ƒç´ å…ƒç»„å…·æœ‰ç‰¹æ®Šçš„è¯­æ³•ã€‚

```python
>>> ()    # 0 elements
()
>>> (10,) # 1 element
(10,)
```

å…ƒç»„æ˜¯åºåˆ—çš„ä¸€ç§

```python
>>> code = ("up", "up", "down", "down") + ("left", "right") * 2
>>> len(code)
8
>>> code[3]
'down'
>>> code.count("down")
2
>>> code.index("left")
4
```

æ“ä½œåˆ—è¡¨å†…å®¹çš„æ–¹æ³•ä¸é€‚ç”¨äºå…ƒç»„ï¼Œå› ä¸ºå…ƒç»„æ˜¯ä¸å¯å˜çš„ã€‚

è™½ç„¶æ— æ³•æ›´æ”¹å…ƒç»„ä¸­çš„å…ƒç´ ï¼Œä½†å¯ä»¥æ›´æ”¹å…ƒç»„ä¸­åŒ…å«çš„å¯å˜å…ƒç´ çš„å€¼ã€‚

![2.4.1](D:\git\SICP_Python\img\2.4.1.png)



å…ƒç»„åœ¨å¤šé‡èµ‹å€¼ä¸­éšå¼ä½¿ç”¨ã€‚ å°†ä¸¤ä¸ªå€¼åˆ†é…ç»™ä¸¤ä¸ªåç§°ä¼šåˆ›å»ºä¸€ä¸ªåŒå…ƒç´ å…ƒç»„ï¼Œç„¶åå°†å…¶è§£åŒ…ã€‚





 ## 2.4.3 å­—å…¸ 

å­—å…¸æ˜¯ Python çš„å†…ç½®æ•°æ®ç±»å‹ï¼Œç”¨äºå­˜å‚¨å’Œå¤„ç†å¯¹åº”å…³ç³»ã€‚ å­—å…¸åŒ…å«é”®å€¼å¯¹ï¼Œå…¶ä¸­é”®å’Œå€¼éƒ½æ˜¯å¯¹è±¡ã€‚ å­—å…¸çš„ç›®çš„æ˜¯æä¾›ä¸€ç§æŠ½è±¡ï¼Œç”¨äºå­˜å‚¨å’Œæ£€ç´¢ä¸æ˜¯ç”±è¿ç»­æ•´æ•°ç´¢å¼•çš„å€¼ï¼Œè€Œæ˜¯ç”±æè¿°æ€§é”®ç´¢å¼•çš„å€¼ã€‚

å­—ç¬¦ä¸²é€šå¸¸ç”¨ä½œé”®ï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯æˆ‘ä»¬å¯¹äº‹ç‰©åç§°çš„å¸¸è§„è¡¨ç¤ºã€‚ è¿™ä¸ªå­—å…¸å­—é¢å€¼ç»™å‡ºäº†å„ç§ç½—é©¬æ•°å­—

```python
>>> numerals = {'I': 1.0, 'V': 5, 'X': 10}
```

é€šè¿‡é”®æŸ¥æ‰¾å€¼ä½¿ç”¨äº†å…ƒç´ é€‰æ‹©è¿ç®—ç¬¦ã€‚

```python
>>> numerals['X']
10
```

å­—å…¸ä¸­çš„æ¯ä¸ªé”®çš„å€¼ä¸èƒ½é‡å¤ã€‚ æ·»åŠ æ–°çš„é”®å€¼å¯¹å’Œæ›´æ”¹é”®çš„ç°æœ‰å€¼éƒ½å¯ä»¥é€šè¿‡èµ‹å€¼è¯­å¥æ¥å®ç°ã€‚

```python
>>> numerals['I'] = 1
>>> numerals['L'] = 50
numerals['V'] += 50
>>> numerals
{'I': 1, 'X': 10, 'L': 50, 'V': 55}
```

è¯·æ³¨æ„ï¼Œ'L' æœªæ·»åŠ åˆ°ä¸Šè¿°è¾“å‡ºçš„æœ«å°¾ã€‚ å­—å…¸æ˜¯é”®å€¼å¯¹çš„æ— åºé›†åˆã€‚ å½“æˆ‘ä»¬æ‰“å°å­—å…¸æ—¶ï¼Œé”®å’Œå€¼æŒ‰æŸç§é¡ºåºå‘ˆç°ï¼Œä½†ä½œä¸ºè¯¥è¯­è¨€çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬æ— æ³•é¢„æµ‹è¯¥é¡ºåºæ˜¯ä»€ä¹ˆã€‚ å¤šæ¬¡è¿è¡Œç¨‹åºæ—¶ï¼Œé¡ºåºå¯èƒ½ä¼šæ”¹å˜ã€‚

å­—å…¸ä¹Ÿå¯ä»¥å‡ºç°åœ¨ç¯å¢ƒå›¾ä¸­ã€‚

![2.4.2](D:\git\SICP_Python\img\2.4.2.png)

å­—å…¸ç±»å‹è¿˜æ”¯æŒå¯¹æ•´ä¸ªå­—å…¸å†…å®¹è¿›è¡Œè¿­ä»£çš„å„ç§æ–¹æ³•ã€‚ é”®ã€å€¼å’Œé¡¹çš„æ–¹æ³•éƒ½è¿”å›å¯è¿­ä»£çš„å€¼ã€‚

```python
>>> sum(numerals.values())
66
```

å¯ä»¥é€šè¿‡è°ƒç”¨  æ„é€ å‡½æ•°`dict`å°†é”®å€¼å¯¹åˆ—è¡¨è½¬æ¢ä¸ºå­—å…¸ã€‚

```python
>>> dict([(3, 9), (4, 16), (5, 25)])
{3: 9, 4: 16, 5: 25}
```

å­—å…¸ç¡®å®æœ‰ä¸€äº›é™åˆ¶ï¼š

- å­—å…¸çš„é”®ä¸èƒ½æ˜¯æˆ–åŒ…å«å¯å˜å€¼ã€‚
- ä¸€ä¸ªå­—å…¸çš„é”®çš„å€¼ä¸èƒ½é‡å¤å‡ºç°åœ¨è¿™ä¸ªå­—å…¸é‡Œ

ç¬¬ä¸€ä¸ªé™åˆ¶ä¸ Python ä¸­å­—å…¸çš„åº•å±‚å®ç°ç›¸å…³ã€‚ è¿™ä¸ªå®ç°çš„ç»†èŠ‚ä¸æ˜¯æœ¬æ–‡çš„ä¸»é¢˜ã€‚ ç›´è§‚åœ°è¯´ï¼Œé”®å‘Šè¯‰ Python åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°å†…å­˜ä¸­çš„é”®å€¼å¯¹ï¼› å¦‚æœé”®æ”¹å˜ï¼Œåˆ™è¯¥å¯¹çš„ä½ç½®å¯èƒ½ä¼šä¸¢å¤±ã€‚ å…ƒç»„é€šå¸¸ç”¨äºå­—å…¸ä¸­çš„é”®ï¼Œå› ä¸ºå…¶ä¸å¯å˜ã€‚

ç¬¬äºŒä¸ªé™åˆ¶æ˜¯å­—å…¸æŠ½è±¡çš„ç»“æœï¼Œå®ƒæ—¨åœ¨å­˜å‚¨å’Œæ£€ç´¢é”®çš„å€¼ã€‚ å¦‚æœå­—å…¸ä¸­æœ€å¤šå­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„å€¼ï¼Œæˆ‘ä»¬èƒ½æ£€ç´¢é”®çš„å€¼ã€‚

å­—å…¸å®ç°çš„ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•` get`ï¼Œå®ƒè¿”å›é”®çš„å€¼ï¼ˆå¦‚æœé”®å­˜åœ¨ï¼‰æˆ–é»˜è®¤å€¼ã€‚ get çš„å‚æ•°æ˜¯é”®å’Œé»˜è®¤å€¼ã€‚

```python
>>> numerals.get('A', 0)
0
>>> numerals.get('V', 0)
5
>>> bob.get("pavo", "ğŸ¤”")  #å¦‚æœpavoä¸æ˜¯bobçš„é”® ï¼Œè¿”å›è¿™ä¸ªè¡¨æƒ…
'ğŸ¤”'
```

å­—å…¸ä¹Ÿæœ‰ç±»ä¼¼äºåˆ—è¡¨çš„ç†è§£è¯­æ³•ã€‚ é”®è¡¨è¾¾å¼å’Œå€¼è¡¨è¾¾å¼ç”¨å†’å·åˆ†éš”ã€‚ è¯„ä¼°å­—å…¸ç†è§£ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—å…¸å¯¹è±¡ã€‚

```python
>>> {x: x*x for x in range(3,6)}
{3: 9, 4: 16, 5: 25}
```



å­—å…¸çš„ä¸€äº›å…¶ä»–æ“ä½œ.

```python
>>>len(bob) #è®¡æ•°é”®çš„ä¸ªæ•°
2

>>> "firstname" in bob  #åˆ¤æ–­é”®åœ¨ä¸åœ¨
True

del bob['threenaem']  #åˆ é™¤å¥â€”â€”å€¼å¯¹

insects = {"spiders": 8, "centipedes": 100, "bees": 6}  
for name in insects:
    print(insects[name])
#ä¸¤è€…ç­‰ä»·    
for name in list(insects):  
    print(insects[name])
    

for key,values in bob.items():#æŠŠbobä¸­é”®å€¼å¯¹çš„å¥èµ‹ç»™key,å€¼èµ‹ç»™values
    ...
for key in bob.key():#bobä¸­é”®å€¼å¯¹çš„é”®èµ‹ç»™key
    ...
for values in bob.values()ï¼š
    ...
for values in set(bob.values()):#å»é‡å¤ 
```



## 2.4.1 å±€éƒ¨çŠ¶æ€

æˆ‘ä»¬ç¬¬ä¸€ä¸ªå¯å˜å¯¹è±¡çš„ä¾‹å­å°±æ˜¯å±€éƒ¨çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€ä¼šåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´æ”¹å˜ã€‚

ä¸ºäº†å±•ç¤ºå‡½æ•°çš„å±€éƒ¨çŠ¶æ€æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œè®©æˆ‘ä»¬å¯¹ä»é“¶è¡Œå–é’±çš„æƒ…å†µè¿›è¡Œå»ºæ¨¡ã€‚æˆ‘ä»¬ä¼šé€šè¿‡åˆ›å»ºå«åš`withdraw`çš„å‡½æ•°æ¥å®ç°å®ƒï¼Œå®ƒå°†è¦å–å‡ºçš„é‡‘é¢ä½œä¸ºå‚æ•°ã€‚å¦‚æœè´¦æˆ·ä¸­æœ‰è¶³å¤Ÿçš„é’±æ¥å–å‡ºï¼Œ`withdraw`åº”è¯¥è¿”å›å–é’±ä¹‹åçš„ä½™é¢ã€‚å¦åˆ™ï¼Œ`withdraw`åº”è¯¥è¿”å›æ¶ˆæ¯`'Insufficient funds'`ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä»¥è´¦æˆ·ä¸­çš„`$100`å¼€å§‹ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡è°ƒç”¨`withdraw`æ¥å¾—åˆ°ä¸‹é¢çš„åºåˆ—ï¼š

```py
>>> withdraw(25)
75
>>> withdraw(25)
50
>>> withdraw(60)
'Insufficient funds'
>>> withdraw(15)
35
```

è§‚å¯Ÿè¡¨è¾¾å¼`withdraw(25)`ï¼Œæ±‚å€¼äº†ä¸¤æ¬¡ï¼Œäº§ç”Ÿäº†ä¸åŒçš„å€¼ã€‚è¿™æ˜¯ä¸€ç§ç”¨æˆ·å®šä¹‰å‡½æ•°çš„æ–°è¡Œä¸ºï¼šå®ƒæ˜¯éçº¯å‡½æ•°ã€‚è°ƒç”¨å‡½æ•°ä¸ä»…ä»…è¿”å›ä¸€ä¸ªå€¼ï¼ŒåŒæ—¶å…·æœ‰ä»¥ä¸€äº›æ–¹å¼ä¿®æ”¹å‡½æ•°çš„å‰¯ä½œç”¨ï¼Œä½¿å¸¦æœ‰ç›¸åŒå‚æ•°çš„ä¸‹æ¬¡è°ƒç”¨è¿”å›ä¸åŒçš„ç»“æœã€‚æˆ‘ä»¬æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œåˆ°ç›®å‰ä¸ºæ­¢éƒ½æ˜¯çº¯å‡½æ•°ï¼Œé™¤éä»–ä»¬è°ƒç”¨äº†éçº¯çš„å†…å»ºå‡½æ•°ã€‚å®ƒä»¬ä»æ—§æ˜¯çº¯å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸å…è®¸ä¿®æ”¹ä»»ä½•åœ¨å±€éƒ¨ç¯å¢ƒå¸§ä¹‹å¤–çš„ä¸œè¥¿ã€‚

ä¸ºäº†ä½¿`withdraw`æœ‰æ„ä¹‰ï¼Œå®ƒå¿…é¡»ç”±ä¸€ä¸ªåˆå§‹è´¦æˆ·ä½™é¢åˆ›å»ºã€‚`make_withdraw`å‡½æ•°æ˜¯ä¸ªé«˜é˜¶å‡½æ•°ï¼Œæ¥å—èµ·å§‹ä½™é¢ä½œä¸ºå‚æ•°ï¼Œ`withdraw`å‡½æ•°æ˜¯å®ƒçš„è¿”å›å€¼ã€‚

```py
>>> withdraw = make_withdraw(100)
```

`make_withdraw`çš„å®ç°éœ€è¦æ–°ç±»å‹çš„è¯­å¥ï¼š`nonlocal`è¯­å¥ã€‚å½“æˆ‘ä»¬è°ƒç”¨`make_withdraw`æ—¶ï¼Œæˆ‘ä»¬å°†åç§°`balance`ç»‘å®šåˆ°åˆå§‹å€¼ä¸Šã€‚ä¹‹åæˆ‘ä»¬å®šä¹‰å¹¶è¿”å›äº†å±€éƒ¨å‡½æ•°ï¼Œ`withdraw`ï¼Œå®ƒåœ¨è°ƒç”¨æ—¶æ›´æ–°å¹¶è¿”å›`balance`çš„å€¼ã€‚

```py
>>> def make_withdraw(balance):
        """Return a withdraw function that draws down balance with each call."""
        def withdraw(amount):
            nonlocal balance                 # Declare the name "balance" nonlocal
            if amount > balance:
                return 'Insufficient funds'
            balance = balance - amount       # Re-bind the existing balance name
            return balance
        return withdraw
```

è¿™ä¸ªå®ç°çš„æ–°å¥‡éƒ¨åˆ†æ˜¯`nonlocal`è¯­å¥ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™æˆ‘ä»¬ä¿®æ”¹äº†åç§°`balance`çš„ç»‘å®šï¼Œç»‘å®šéƒ½ä¼šåœ¨`balance`æ‰€ç»‘å®šçš„ç¬¬ä¸€ä¸ªå¸§ä¸­ä¿®æ”¹ã€‚å›å¿†ä¸€ä¸‹ï¼Œåœ¨æ²¡æœ‰`nonlocal`è¯­å¥çš„æƒ…å†µä¸‹ï¼Œèµ‹å€¼è¯­å¥æ€»æ˜¯ä¼šåœ¨ç¯å¢ƒçš„ç¬¬ä¸€ä¸ªå¸§ä¸­ç»‘å®šåç§°ã€‚`nonlocal`è¯­å¥è¡¨æ˜ï¼Œåç§°å‡ºç°åœ¨ç¯å¢ƒä¸­ä¸æ˜¯ç¬¬ä¸€ä¸ªï¼ˆå±€éƒ¨ï¼‰å¸§ï¼Œæˆ–è€…æœ€åä¸€ä¸ªï¼ˆå…¨å±€ï¼‰å¸§çš„å…¶å®ƒåœ°æ–¹ã€‚

æˆ‘ä»¬å¯ä»¥å°†è¿™äº›ä¿®æ”¹ä½¿ç”¨ç¯å¢ƒå›¾ç¤ºæ¥å¯è§†åŒ–ã€‚ä¸‹é¢çš„ç¯å¢ƒå›¾ç¤ºå±•ç¤ºäº†æ¯ä¸ªè°ƒç”¨çš„æ•ˆæœï¼Œä»¥ä¸Šé¢çš„å®šä¹‰å¼€å§‹ã€‚æˆ‘ä»¬çœç•¥äº†å‡½æ•°å€¼ä¸­çš„ä»£ç ï¼Œä»¥åŠä¸åœ¨æˆ‘ä»¬è®¨è®ºä¸­çš„è¡¨è¾¾å¼æ ‘ã€‚

![](img/nonlocal_def.png)

æˆ‘ä»¬çš„å®šä¹‰è¯­å¥æ‹¥æœ‰å¹³å¸¸çš„æ•ˆæœï¼šå®ƒåˆ›å»ºäº†æ–°çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼Œå¹¶ä¸”å°†åç§°`make_withdraw`åœ¨å…¨å±€å¸§ä¸­ç»‘å®šåˆ°é‚£ä¸ªå‡½æ•°ä¸Šã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆå§‹çš„ä½™é¢å‚æ•°`20`æ¥è°ƒç”¨`make_withdraw`ã€‚

```py
>>> wd = make_withdraw(20)
```

è¿™ä¸ªèµ‹å€¼è¯­å¥å°†åç§°`wd`ç»‘å®šåˆ°å…¨å±€å¸§ä¸­çš„è¿”å›å‡½æ•°ä¸Šï¼š

![](img/nonlocal_assign.png)

æ‰€è¿”å›çš„å‡½æ•°ï¼Œï¼ˆå†…éƒ¨ï¼‰å«åš`withdraw`ï¼Œå’Œå®šä¹‰æ‰€åœ¨ä½ç½®å³`make_withdraw`çš„å±€éƒ¨ç¯å¢ƒç›¸å…³è”ã€‚åç§°`balance`åœ¨è¿™ä¸ªå±€éƒ¨ç¯å¢ƒä¸­ç»‘å®šã€‚åœ¨ä¾‹å­çš„å‰©ä½™éƒ¨åˆ†ä¸­ï¼Œ`balance`åç§°åªæœ‰è¿™ä¸€ä¸ªç»‘å®šï¼Œè¿™éå¸¸é‡è¦ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬æ±‚å‡ºä»¥æ€»æ•°`5`è°ƒç”¨`withdraw`çš„è¡¨è¾¾å¼çš„å€¼ï¼š

```py
>>> wd(5)
15
```

åç§°`wd`ç»‘å®šåˆ°äº†`withdraw`å‡½æ•°ä¸Šï¼Œæ‰€ä»¥`withdraw`çš„å‡½æ•°ä½“åœ¨æ–°çš„ç¯å¢ƒä¸­æ±‚å€¼ï¼Œæ–°çš„ç¯å¢ƒæ‰©å±•è‡ª`withdraw`å®šä¹‰æ‰€åœ¨çš„ç¯å¢ƒã€‚è·Ÿè¸ª`withdraw`æ±‚å€¼çš„æ•ˆæœå±•ç¤ºäº† Python ä¸­`nonlocal`è¯­å¥çš„æ•ˆæœã€‚

![](img/nonlocal_call.png)

`withdraw`çš„èµ‹å€¼è¯­å¥é€šå¸¸åœ¨`withdraw`çš„å±€éƒ¨å¸§ä¸­ä¸º`balance`åˆ›å»ºæ–°çš„ç»‘å®šã€‚ç”±äº`nonlocal`è¯­å¥ï¼Œèµ‹å€¼è¿ç®—æ‰¾åˆ°äº†`balance`å®šä¹‰ä½ç½®çš„ç¬¬ä¸€å¸§ï¼Œå¹¶åœ¨é‚£é‡Œé‡æ–°ç»‘å®šåç§°ã€‚å¦‚æœ`balance`ä¹‹å‰æ²¡æœ‰ç»‘å®šåˆ°å€¼ä¸Šï¼Œé‚£ä¹ˆ`nonlocal`è¯­å¥ä¼šäº§ç”Ÿé”™è¯¯ã€‚

é€šè¿‡ä¿®æ”¹`balance`ç»‘å®šçš„è¡Œä¸ºï¼Œæˆ‘ä»¬ä¹Ÿä¿®æ”¹äº†`withdraw`å‡½æ•°ã€‚ä¸‹æ¬¡`withdraw`è°ƒç”¨çš„æ—¶å€™ï¼Œåç§°`balance`ä¼šæ±‚å€¼ä¸º`15`è€Œä¸æ˜¯`20`ã€‚

å½“æˆ‘ä»¬ç¬¬äºŒæ¬¡è°ƒç”¨`wd`æ—¶ï¼Œ

```py
>>> wd(3)
12
```

æˆ‘ä»¬å‘ç°ç»‘å®šåˆ°`balance`çš„å€¼çš„ä¿®æ”¹å¯åœ¨ä¸¤ä¸ªè°ƒç”¨ä¹‹é—´ç§¯ç´¯ã€‚

![](img/nonlocal_recall.png)

è¿™é‡Œï¼Œç¬¬äºŒæ¬¡è°ƒç”¨`withdraw`ä¼šåˆ›å»ºç¬¬äºŒä¸ªå±€éƒ¨å¸§ï¼Œåƒä¹‹å‰ä¸€æ ·ï¼Œä½†æ˜¯ï¼Œ`withdraw`çš„ä¸¤ä¸ªå¸§éƒ½æ‰©å±•è‡ª`make_withdraw`çš„ç¯å¢ƒï¼Œå®ƒä»¬éƒ½åŒ…å«`balance`çš„ç»‘å®šã€‚æ‰€ä»¥ï¼Œå®ƒä»¬å…±äº«ç‰¹å®šçš„åç§°ç»‘å®šï¼Œè°ƒç”¨`withdraw`å…·æœ‰æ”¹å˜ç¯å¢ƒçš„å‰¯ä½œç”¨ï¼Œå¹¶ä¸”ä¼šç”±ä¹‹åçš„`withdraw`è°ƒç”¨ç»§æ‰¿ã€‚

**å®è·µæŒ‡å—ã€‚**é€šè¿‡å¼•å…¥`nonlocal`è¯­å¥ï¼Œæˆ‘ä»¬å‘ç°äº†èµ‹å€¼è¯­å¥çš„åŒé‡ä½œç”¨ã€‚å®ƒä»¬ä¿®æ”¹å±€éƒ¨ç»‘å®šï¼Œæˆ–è€…ä¿®æ”¹éå±€éƒ¨ç»‘å®šã€‚å®é™…ä¸Šï¼Œèµ‹å€¼è¯­å¥å·²ç»æœ‰äº†ä¸¤ä¸ªä½œç”¨ï¼šåˆ›å»ºæ–°çš„ç»‘å®šï¼Œæˆ–è€…é‡æ–°ç»‘å®šç°æœ‰åç§°ã€‚Python èµ‹å€¼çš„è®¸å¤šä½œç”¨ä½¿èµ‹å€¼è¯­å¥çš„æ‰§è¡Œæ•ˆæœå˜å¾—æ¨¡ç³Šã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä½ åº”è¯¥ç”¨æ–‡æ¡£æ¸…æ™°è®°å½•ä½ çš„ä»£ç ï¼Œä½¿èµ‹å€¼çš„æ•ˆæœå¯è¢«å…¶å®ƒäººç†è§£ã€‚

## 2.4.2 éå±€éƒ¨èµ‹å€¼çš„å¥½å¤„

éå±€éƒ¨èµ‹å€¼æ˜¯å°†ç¨‹åºä½œä¸ºç‹¬ç«‹å’Œè‡ªä¸»çš„å¯¹è±¡è§‚å¯Ÿçš„é‡è¦æ­¥éª¤ï¼Œå¯¹è±¡å½¼æ­¤äº¤äº’ï¼Œä½†æ˜¯å„è‡ªç®¡ç†å„è‡ªçš„å†…éƒ¨çŠ¶æ€ã€‚

ç‰¹åˆ«åœ°ï¼Œéå±€éƒ¨èµ‹å€¼æä¾›äº†åœ¨å‡½æ•°çš„å±€éƒ¨èŒƒå›´ä¸­ç»´æŠ¤ä¸€äº›çŠ¶æ€çš„èƒ½åŠ›ï¼Œè¿™äº›çŠ¶æ€ä¼šåœ¨å‡½æ•°ä¹‹åçš„è°ƒç”¨ä¸­æ¼”åŒ–ã€‚å’Œç‰¹å®š`withdraw`å‡½æ•°ç›¸å…³çš„`balance`åœ¨æ‰€æœ‰è¯¥å‡½æ•°çš„è°ƒç”¨ä¸­å…±äº«ã€‚ä½†æ˜¯ï¼Œ`withdraw`å®ä¾‹ä¸­çš„`balance`ç»‘å®šå¯¹ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†ä¸å¯è§ã€‚åªæœ‰`withdraw`å…³è”åˆ°äº†`make_withdraw`çš„å¸§ï¼Œ`withdraw`åœ¨é‚£é‡Œè¢«å®šä¹‰ã€‚å¦‚æœ`make_withdraw`å†æ¬¡è°ƒç”¨ï¼Œå®ƒä¼šåˆ›å»ºå•ç‹¬çš„å¸§ï¼Œå¸¦æœ‰å•ç‹¬çš„`balance`ç»‘å®šã€‚

æˆ‘ä»¬å¯ä»¥ç»§ç»­ä»¥æˆ‘ä»¬çš„ä¾‹å­æ¥å±•ç¤ºè¿™ä¸ªè§‚ç‚¹ã€‚`make_withdraw`çš„ç¬¬äºŒä¸ªè°ƒç”¨è¿”å›äº†ç¬¬äºŒä¸ª`withdraw`å‡½æ•°ï¼Œå®ƒå…³è”åˆ°äº†å¦ä¸€ä¸ªç¯å¢ƒä¸Šã€‚

```py
>>> wd2 = make_withdraw(7)
```

ç¬¬äºŒä¸ª`withdraw`å‡½æ•°ç»‘å®šåˆ°äº†å…¨å±€å¸§çš„åç§°`wd2`ä¸Šã€‚æˆ‘ä»¬ä½¿ç”¨æ˜Ÿå·æ¥çœç•¥äº†è¡¨ç¤ºè¿™ä¸ªç»‘å®šçš„çº¿ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çœ‹åˆ°å®é™…ä¸Šæœ‰ä¸¤ä¸ª`balance`çš„ç»‘å®šã€‚åç§°`wd`ä»æ—§ç»‘å®šåˆ°ä½™é¢ä¸º`12`çš„`withdraw`å‡½æ•°ä¸Šï¼Œè€Œ`wd2`ç»‘å®šåˆ°äº†ä½™é¢ä¸º`7`çš„æ–°çš„`withdraw`å‡½æ•°ä¸Šã€‚

![](img/nonlocal_def2.png)

æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ç»‘å®šåˆ°`wd2`ä¸Šçš„ç¬¬äºŒä¸ª`withdraw`å‡½æ•°ï¼š

```py
>>> wd2(6)
1
```

è¿™ä¸ªè°ƒç”¨ä¿®æ”¹äº†éå±€éƒ¨åç§°`balance`çš„ç»‘å®šï¼Œä½†æ˜¯ä¸å½±å“åœ¨å…¨å±€å¸§ä¸­ç»‘å®šåˆ°åç§°`wd`çš„ç¬¬ä¸€ä¸ª`withdraw`ã€‚

![](img/nonlocal_call2.png)

è¿™æ ·ï¼Œ`withdraw`çš„æ¯ä¸ªå®ä¾‹éƒ½ç»´æŠ¤å®ƒè‡ªå·±çš„ä½™é¢çŠ¶æ€ï¼Œä½†æ˜¯è¿™ä¸ªçŠ¶æ€å¯¹ç¨‹åºä¸­å…¶å®ƒå‡½æ•°ä¸å¯è§ã€‚åœ¨æ›´é«˜å±‚é¢ä¸Šè§‚å¯Ÿè¿™ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬åˆ›å»ºäº†é“¶è¡Œè´¦æˆ·çš„æŠ½è±¡ï¼Œå®ƒç®¡ç†è‡ªå·±çš„å†…éƒ¨çŠ¶æ€ï¼Œä½†ä»¥ä¸€ç§æ–¹å¼å¯¹çœŸå®ä¸–ç•Œçš„è´¦æˆ·è¿›è¡Œå»ºæ¨¡ï¼šå®ƒåŸºäºè‡ªå·±çš„å†å²æå–è¯·æ±‚æ¥éšæ—¶é—´å˜åŒ–ã€‚

## 2.4.3 éå±€éƒ¨èµ‹å€¼çš„ä»£ä»·

æˆ‘ä»¬æ‰©å±•äº†æˆ‘ä»¬çš„è®¡ç®—ç¯å¢ƒæ¨¡å‹ï¼Œç”¨äºè§£é‡Šéå±€éƒ¨èµ‹å€¼çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œéå±€éƒ¨å¤åˆ¶ä¸æˆ‘ä»¬æ€è€ƒåç§°å’Œå€¼çš„æ–¹å¼æœ‰ä¸€äº›ç»†å¾®å·®å¼‚ã€‚

ä¹‹å‰ï¼Œæˆ‘ä»¬çš„å€¼å¹¶æ²¡æœ‰æ”¹å˜ï¼Œä»…ä»…æ˜¯æˆ‘ä»¬çš„åç§°å’Œç»‘å®šå‘ç”Ÿäº†å˜åŒ–ã€‚å½“ä¸¤ä¸ªåç§°`a`å’Œ`b`ç»‘å®šåˆ°`4`ä¸Šæ—¶ï¼Œå®ƒä»¬ç»‘å®šåˆ°äº†ç›¸åŒçš„`4`è¿˜æ˜¯ä¸åŒçš„`4`å¹¶ä¸é‡è¦ã€‚æˆ‘ä»¬è¯´ï¼Œåªæœ‰ä¸€ä¸ª`4`å¯¹è±¡ï¼Œå¹¶ä¸”å®ƒæ°¸ä¸ä¼šæ”¹å˜ã€‚

ä½†æ˜¯ï¼Œå¸¦æœ‰çŠ¶æ€çš„å‡½æ•°ä¸æ˜¯è¿™æ ·çš„ã€‚å½“ä¸¤ä¸ªåç§°`wd`å’Œ`wd2`éƒ½ç»‘å®šåˆ°`withdraw`å‡½æ•°æ—¶ï¼Œå®ƒä»¬ç»‘å®šåˆ°ç›¸åŒå‡½æ•°è¿˜æ˜¯å‡½æ•°çš„ä¸¤ä¸ªä¸åŒå®ä¾‹ï¼Œå°±å¾ˆé‡è¦äº†ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼Œå®ƒä¸æˆ‘ä»¬ä¹‹å‰åˆ†æçš„é‚£ä¸ªæ­£å¥½ç›¸åï¼š

```py
>>> wd = make_withdraw(12)
>>> wd2 = wd
>>> wd2(1)
11
>>> wd(1)
10
```

è¿™é‡Œï¼Œé€šè¿‡`wd2`è°ƒç”¨å‡½æ•°ä¼šä¿®æ”¹åç§°ä¸º`wd`çš„å‡½æ•°çš„å€¼ï¼Œå› ä¸ºä¸¤ä¸ªåç§°éƒ½æŒ‡å‘ç›¸åŒçš„å‡½æ•°ã€‚è¿™äº›è¯­å¥æ‰§è¡Œä¹‹åçš„ç¯å¢ƒå›¾ç¤ºå±•ç¤ºäº†è¿™ä¸ªç°è±¡ï¼š

![](img/nonlocal_corefer.png)

ä¸¤ä¸ªåç§°æŒ‡å‘åŒä¸€ä¸ªå€¼åœ¨ä¸–ç•Œä¸Šä¸å¸¸è§ï¼Œä½†æˆ‘ä»¬ç¨‹åºä¸­å°±æ˜¯è¿™æ ·ã€‚ä½†æ˜¯ï¼Œç”±äºå€¼ä¼šéšæ—¶é—´æ”¹å˜ï¼Œæˆ‘ä»¬å¿…é¡»éå¸¸ä»”ç»†æ¥ç†è§£å…¶å®ƒåç§°ä¸Šçš„å˜åŒ–æ•ˆæœï¼Œå®ƒä»¬å¯èƒ½æŒ‡å‘è¿™äº›å€¼ã€‚

æ­£ç¡®åˆ†æå¸¦æœ‰éå±€éƒ¨èµ‹å€¼ä»£ç çš„å…³é”®æ˜¯ï¼Œè®°ä½åªæœ‰å‡½æ•°è°ƒç”¨å¯ä»¥åˆ›å»ºæ–°çš„å¸§ã€‚èµ‹å€¼è¯­å¥å§‹ç»ˆæ”¹å˜ç°æœ‰å¸§ä¸­çš„ç»‘å®šã€‚è¿™é‡Œï¼Œé™¤é`make_withdraw`è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œ`balance`è¿˜æ˜¯åªæœ‰ä¸€ä¸ªç»‘å®šã€‚

**å˜ä¸ä¸å˜ã€‚**è¿™äº›ç»†å¾®å·®åˆ«å‡ºç°çš„åŸå› æ˜¯ï¼Œé€šè¿‡å¼•å…¥ä¿®æ”¹éå±€éƒ¨ç¯å¢ƒçš„éçº¯å‡½æ•°ï¼Œæˆ‘ä»¬æ”¹å˜äº†è¡¨è¾¾å¼çš„æœ¬è´¨ã€‚åªå«æœ‰çº¯å‡½æ•°çš„è¡¨è¾¾å¼æ˜¯å¼•ç”¨é€æ˜ï¼ˆreferentially transparentï¼‰çš„ã€‚å¦‚æœæˆ‘ä»¬å°†å®ƒçš„å­è¡¨è¾¾å¼æ¢æˆå­è¡¨è¾¾å¼çš„å€¼ï¼Œå®ƒçš„å€¼ä¸ä¼šæ”¹å˜ã€‚

é‡æ–°ç»‘å®šçš„æ“ä½œè¿åäº†å¼•ç”¨é€æ˜çš„æ¡ä»¶ï¼Œå› ä¸ºå®ƒä»¬ä¸ä»…ä»…è¿”å›ä¸€ä¸ªå€¼ã€‚å®ƒä»¬ä¿®æ”¹äº†ç¯å¢ƒã€‚å½“æˆ‘ä»¬å¼•å…¥ä»»æ„é‡ç»‘å®šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šé‡åˆ°ä¸€ä¸ªæ£˜æ‰‹çš„è®¤è¯†è®ºé—®é¢˜ï¼šå®ƒå¯¹äºä¸¤ä¸ªç›¸åŒçš„å€¼æ„å‘³ç€ä»€ä¹ˆã€‚åœ¨æˆ‘ä»¬çš„è®¡ç®—ç¯å¢ƒæ¨¡å‹ä¸­ï¼Œä¸¤ä¸ªåˆ†åˆ«å®šä¹‰çš„å‡½æ•°å¹¶ä¸æ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªçš„æ”¹å˜å¹¶ä¸å½±å“å¦ä¸€ä¸ªã€‚

é€šå¸¸ï¼Œåªè¦æˆ‘ä»¬ä¸ä¼šä¿®æ”¹æ•°æ®å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å¤åˆæ•°æ®å¯¹è±¡çœ‹åšå…¶éƒ¨åˆ†çš„æ€»å’Œã€‚ä¾‹å¦‚ï¼Œæœ‰ç†æ•°å¯ä»¥é€šè¿‡æä¾›åˆ†å­å’Œåˆ†æ¯æ¥ç¡®å®šã€‚ä½†æ˜¯è¿™ä¸ªè§‚ç‚¹åœ¨å˜åŒ–å‡ºç°æ—¶ä¸å†æˆç«‹äº†ï¼Œå…¶ä¸­å¤åˆæ•°æ®å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªâ€œèº«ä»½â€ï¼Œä¸åŒäºç»„æˆå®ƒçš„å„ä¸ªéƒ¨åˆ†ã€‚å³ä½¿æˆ‘ä»¬é€šè¿‡å–é’±æ¥ä¿®æ”¹äº†ä½™é¢ï¼ŒæŸä¸ªé“¶è¡Œè´¦æˆ·è¿˜æ˜¯â€œç›¸åŒâ€çš„é“¶è¡Œè´¦æˆ·ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥è®©ä¸¤ä¸ªé“¶è¡Œè´¦æˆ·ç¢°å·§å…·æœ‰ç›¸åŒçš„ä½™é¢ï¼Œä½†å®ƒä»¬æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚

å°½ç®¡å®ƒå¼•å…¥äº†æ–°çš„å›°éš¾ï¼Œéå±€éƒ¨èµ‹å€¼æ˜¯ä¸ªåˆ›å»ºæ¨¡å—åŒ–ç¼–ç¨‹çš„å¼ºå¤§å·¥å…·ï¼Œç¨‹åºçš„ä¸åŒéƒ¨åˆ†ï¼Œå¯¹åº”ä¸åŒçš„ç¯å¢ƒå¸§ï¼Œå¯ä»¥åœ¨ç¨‹åºæ‰§è¡Œä¸­ç‹¬ç«‹æ¼”åŒ–ã€‚è€Œä¸”ï¼Œä½¿ç”¨å¸¦æœ‰å±€éƒ¨çŠ¶æ€çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½å®ç°å¯å˜æ•°æ®ç±»å‹ã€‚åœ¨è¿™ä¸€èŠ‚çš„å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸€äº›æœ€å®ç”¨çš„ Python å†…å»ºæ•°æ®ç±»å‹ï¼Œä»¥åŠä½¿ç”¨å¸¦æœ‰éå±€éƒ¨èµ‹å€¼çš„å‡½æ•°ï¼Œæ¥å®ç°è¿™äº›æ•°æ®ç±»å‹çš„ä¸€äº›æ–¹æ³•ã€‚

## 2.4.4 åˆ—è¡¨

`list`æ˜¯ Python ä¸­æœ€ä½¿ç”¨å’Œçµæ´»çš„æ•°æ®ç±»å‹ã€‚åˆ—è¡¨ç±»ä¼¼äºå…ƒç»„ï¼Œä½†æ˜¯å®ƒæ˜¯å¯å˜çš„ã€‚æ–¹æ³•è°ƒç”¨å’Œèµ‹å€¼è¯­å¥éƒ½å¯ä»¥ä¿®æ”¹åˆ—è¡¨çš„å†…å®¹ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªå±•ç¤ºï¼ˆæå¤§ç®€åŒ–çš„ï¼‰æ‰‘å…‹ç‰Œå†å²çš„ä¾‹å­ï¼Œæ¥ä»‹ç»è®¸å¤šåˆ—è¡¨ç¼–è¾‘æ“ä½œã€‚ä¾‹å­ä¸­çš„æ³¨é‡Šæè¿°äº†æ¯ä¸ªæ–¹æ³•çš„æ•ˆæœã€‚

æ‰‘å…‹ç‰Œå‘æ˜äºä¸­å›½ï¼Œå¤§æ¦‚åœ¨ 9 ä¸–çºªã€‚æ—©æœŸçš„ç‰Œç»„ä¸­æœ‰ä¸‰ä¸ªèŠ±è‰²ï¼Œå®ƒä»¬å¯¹åº”é’±çš„ä¸‰ä¸ªé¢é¢ã€‚

```py
>>> chinese_suits = ['coin', 'string', 'myriad']  # A list literal
>>> suits = chinese_suits                         # Two names refer to the same list
```

æ‰‘å…‹ç‰Œä¼ åˆ°æ¬§æ´²ï¼ˆä¹Ÿå¯èƒ½é€šè¿‡åŸƒåŠï¼‰ä¹‹åï¼Œè¥¿ç­ç‰™çš„ç‰Œç»„ï¼ˆoroï¼‰ä¸­ä¹‹åªä¿ç•™äº†ç¡¬å¸çš„èŠ±è‰²ã€‚

```py
>>> suits.pop()             # Removes and returns the final element
'myriad'
>>> suits.remove('string')  # Removes the first element that equals the argument
```

ç„¶ååˆæ·»åŠ äº†ä¸‰ä¸ªæ–°çš„èŠ±è‰²ï¼ˆå®ƒä»¬çš„è®¾è®¡å’Œåç§°éšæ—¶é—´è€Œæ¼”åŒ–ï¼‰ï¼Œ

```py
>>> suits.append('cup')              # Add an element to the end
>>> suits.extend(['sword', 'club'])  # Add all elements of a list to the end
```

æ„å¤§åˆ©äººæŠŠå‰‘å«åšâ€œé»‘æ¡ƒâ€ï¼š

```py
>>> suits[2] = 'spade'  # Replace an element
```

ä¸‹é¢æ˜¯ä¼ ç»Ÿçš„æ„å¤§åˆ©ç‰Œç»„ï¼š

```py
>>> suits
['coin', 'cup', 'spade', 'club']
```

æˆ‘ä»¬ç°åœ¨åœ¨ç¾å›½ä½¿ç”¨çš„æ³•å¼å˜ä½“ä¿®æ”¹äº†å‰ä¸¤ä¸ªï¼š

```py
>>> suits[0:2] = ['heart', 'diamond']  # Replace a slice
>>> suits
['heart', 'diamond', 'spade', 'club']
```

ä¹Ÿå­˜åœ¨ç”¨äºæ’å…¥ã€æ’åºå’Œåè½¬åˆ—è¡¨çš„æ“ä½œã€‚æ‰€æœ‰è¿™äº›ä¿®æ”¹æ“ä½œéƒ½æ”¹å˜äº†åˆ—è¡¨çš„å€¼ï¼Œå®ƒä»¬å¹¶ä¸åˆ›å»ºæ–°çš„åˆ—è¡¨å¯¹è±¡ã€‚

**å…±äº«å’Œèº«ä»½ã€‚**ç”±äºæˆ‘ä»¬ä¿®æ”¹äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„åˆ—è¡¨ï¼Œç»‘å®šåˆ°åç§°`chinese_suits`ä¸Šçš„å¯¹è±¡ä¹Ÿæ”¹å˜äº†ï¼Œå› ä¸ºå®ƒä¸ç»‘å®šåˆ°`suits`ä¸Šçš„å¯¹è±¡æ˜¯ç›¸åŒçš„åˆ—è¡¨å¯¹è±¡ã€‚

```py
>>> chinese_suits  # This name co-refers with "suits" to the same list
['heart', 'diamond', 'spade', 'club']
```

åˆ—è¡¨å¯ä»¥ä½¿ç”¨`list`æ„é€ å‡½æ•°æ¥å¤åˆ¶ã€‚å…¶ä¸­ä¸€ä¸ªçš„æ”¹å˜ä¸ä¼šå½±å“å¦ä¸€ä¸ªï¼Œé™¤éå®ƒä»¬å…±äº«ç›¸åŒçš„ç»“æ„ã€‚

```py
>>> nest = list(suits)  # Bind "nest" to a second list with the same elements
>>> nest[0] = suits     # Create a nested list
```

åœ¨æœ€åçš„èµ‹å€¼ä¹‹åï¼Œæˆ‘ä»¬åªå‰©ä¸‹ä¸‹é¢çš„ç¯å¢ƒï¼Œå…¶ä¸­åˆ—è¡¨ä½¿ç”¨ç›’å­å’ŒæŒ‡é’ˆçš„ç¬¦å·æ¥è¡¨ç¤ºï¼š

![](img/lists.png)

æ ¹æ®è¿™ä¸ªç¯å¢ƒï¼Œä¿®æ”¹ç”±`suites`æŒ‡å‘çš„åˆ—è¡¨ä¼šå½±å“`nest`ç¬¬ä¸€ä¸ªå…ƒç´ çš„åµŒå¥—åˆ—è¡¨ï¼Œä½†æ˜¯ä¸ä¼šå½±å“å…¶ä»–å…ƒç´ ï¼š

```py
>>> suits.insert(2, 'Joker')  # Insert an element at index 2, shifting the rest
>>> nest
[['heart', 'diamond', 'Joker', 'spade', 'club'], 'diamond', 'spade', 'club']
```

ä¸ä¹‹ç±»ä¼¼ï¼Œåœ¨`next`çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸Šæ’¤é”€è¿™ä¸ªä¿®æ”¹ä¹Ÿä¼šå½±å“åˆ°`suit`ã€‚

ç”±äºè¿™ä¸ª`pop`æ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ‘ä»¬è¿”å›åˆ°äº†ä¸Šé¢æè¿°çš„ç¯å¢ƒã€‚

ç”±äºä¸¤ä¸ªåˆ—è¡¨å…·æœ‰ç›¸åŒå†…å®¹ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯ä¸åŒçš„åˆ—è¡¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ‰‹æ®µæ¥æµ‹è¯•ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚Python å¼•å…¥äº†ä¸¤ä¸ªæ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå«åš`is`å’Œ`is not`ï¼Œæµ‹è¯•äº†ä¸¤ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šæ˜¯å¦æ±‚å€¼ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„å½“å‰å€¼ç›¸ç­‰ï¼Œå¹¶ä¸”ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜å§‹ç»ˆä¼šå½±å“å¦ä¸€ä¸ªï¼Œé‚£ä¹ˆä¸¤ä¸ªå¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚èº«ä»½æ˜¯ä¸ªæ¯”ç›¸ç­‰æ€§æ›´å¼ºçš„æ¡ä»¶ã€‚

> è¯‘è€…æ³¨ï¼šä¸¤ä¸ªå¯¹è±¡å½“ä¸”ä»…å½“åœ¨å†…å­˜ä¸­çš„ä½ç½®ç›¸åŒæ—¶ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚CPython çš„å®ç°ç›´æ¥æ¯”è¾ƒå¯¹è±¡çš„åœ°å€æ¥ç¡®å®šã€‚

```py
>>> suits is nest[0]
True
>>> suits is ['heart', 'diamond', 'spade', 'club']
False
>>> suits == ['heart', 'diamond', 'spade', 'club']
True
```

æœ€åçš„ä¸¤ä¸ªæ¯”è¾ƒå±•ç¤ºäº†`is`å’Œ`==`çš„åŒºåˆ«ï¼Œå‰è€…æ£€æŸ¥èº«ä»½ï¼Œè€Œåè€…æ£€æŸ¥å†…å®¹çš„ç›¸ç­‰æ€§ã€‚

**åˆ—è¡¨æ¨å¯¼å¼ã€‚**åˆ—è¡¨æ¨å¯¼å¼ä½¿ç”¨æ‰©å±•è¯­æ³•æ¥åˆ›å»ºåˆ—è¡¨ï¼Œä¸ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„è¯­æ³•ç›¸ä¼¼ã€‚

ä¾‹å¦‚ï¼Œ`unicodedata`æ¨¡å—è·Ÿè¸ªäº† Unicode å­—æ¯è¡¨ä¸­æ¯ä¸ªå­—ç¬¦çš„å®˜æ–¹åç§°ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥æ‰¾ä¸åç§°å¯¹åº”çš„å­—ç¬¦ï¼ŒåŒ…å«è¿™äº›å¡ç‰ŒèŠ±è‰²çš„å­—ç¬¦ã€‚

```py
>>> from unicodedata import lookup
>>> [lookup('WHITE ' + s.upper() + ' SUIT') for s in suits]
['â™¡', 'â™¢', 'â™¤', 'â™§']
```

åˆ—è¡¨æ¨å¯¼å¼ä½¿ç”¨åºåˆ—çš„æ¥å£çº¦å®šå¢å¼ºäº†æ•°æ®å¤„ç†çš„èŒƒå¼ï¼Œå› ä¸ºåˆ—è¡¨æ˜¯ä¸€ç§åºåˆ—æ•°æ®ç±»å‹ã€‚

**æ‰©å±•é˜…è¯»ã€‚**Dive Into Python 3 çš„[æ¨å¯¼å¼](http://diveintopython3.ep.io/comprehensions.html)ä¸€ç« åŒ…å«äº†ä¸€äº›ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Python æµè§ˆè®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ä¸€ç« ä»‹ç»äº†`os`æ¨¡å—ï¼Œå®ƒå¯ä»¥åˆ—å‡ºç›®å½•çš„å†…å®¹ã€‚è¿™ä¸ªææ–™å¹¶ä¸æ˜¯è¿™é—¨è¯¾çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æ¨èç»™ä»»ä½•æƒ³è¦å¢åŠ  Python çŸ¥è¯†å’ŒæŠ€å·§çš„äººã€‚

**å®ç°ã€‚**åˆ—è¡¨æ˜¯åºåˆ—ï¼Œå°±åƒå…ƒç»„ä¸€æ ·ã€‚Python è¯­è¨€å¹¶ä¸æä¾›ç»™æˆ‘ä»¬åˆ—è¡¨å®ç°çš„ç›´æ¥æ–¹æ³•ï¼Œåªæä¾›åºåˆ—æŠ½è±¡ï¼Œå’Œæˆ‘ä»¬åœ¨è¿™ä¸€èŠ‚ä»‹ç»çš„å¯å˜æ–¹æ³•ã€‚ä¸ºäº†å…‹æœè¿™ä¸€è¯­è¨€å±‚é¢çš„æŠ½è±¡ç•Œé™ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å‘åˆ—è¡¨çš„å‡½æ•°å¼å®ç°ï¼Œå†æ¬¡ä½¿ç”¨é€’å½’è¡¨ç¤ºã€‚è¿™ä¸€èŠ‚ä¹Ÿæœ‰ç¬¬äºŒä¸ªç›®çš„ï¼šåŠ æ·±æˆ‘ä»¬å¯¹è°ƒåº¦å‡½æ•°çš„ç†è§£ã€‚

æˆ‘ä»¬ä¼šå°†åˆ—è¡¨å®ç°ä¸ºå‡½æ•°ï¼Œå®ƒå°†ä¸€ä¸ªé€’å½’åˆ—è¡¨ä½œä¸ºè‡ªå·±çš„å±€éƒ¨çŠ¶æ€ã€‚åˆ—è¡¨éœ€è¦æœ‰ä¸€ä¸ªèº«ä»½ï¼Œå°±åƒä»»ä½•å¯å˜å€¼é‚£æ ·ã€‚ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨`None`æ¥è¡¨ç¤ºä»»ä½•ç©ºçš„å¯å˜åˆ—è¡¨ï¼Œå› ä¸ºä¸¤ä¸ªç©ºåˆ—è¡¨å¹¶ä¸æ˜¯ç›¸åŒçš„å€¼ï¼ˆä¾‹å¦‚ï¼Œå‘ä¸€ä¸ªåˆ—è¡¨æ·»åŠ å…ƒç´ å¹¶ä¸ä¼šæ·»åŠ åˆ°å¦ä¸€ä¸ªï¼‰ï¼Œä½†æ˜¯`None is None`ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸¤ä¸ªä¸åŒçš„å‡½æ•°è¶³ä»¥åŒºåˆ†ä¸¤ä¸ªä¸¤ä¸ªç©ºåˆ—è¡¨ï¼Œå®ƒä»¬éƒ½å°†`empty_rlist`ä½œä¸ºå±€éƒ¨çŠ¶æ€ã€‚

æˆ‘ä»¬çš„å¯å˜åˆ—è¡¨æ˜¯ä¸ªè°ƒåº¦å‡½æ•°ï¼Œå°±åƒæˆ‘ä»¬å¶å¯¹çš„å‡½æ•°å¼å®ç°ä¹Ÿæ˜¯ä¸ªè°ƒåº¦å‡½æ•°ã€‚å®ƒæ£€æŸ¥è¾“å…¥â€œä¿¡æ¯â€æ˜¯å¦ä¸ºå·²çŸ¥ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹æ¯ä¸ªä¸åŒçš„è¾“å…¥æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚æˆ‘ä»¬çš„å¯å˜åˆ—è¡¨å¯å“åº”äº”ä¸ªä¸åŒçš„ä¿¡æ¯ã€‚å‰ä¸¤ä¸ªå®ç°äº†åºåˆ—æŠ½è±¡çš„è¡Œä¸ºã€‚æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ·»åŠ æˆ–åˆ é™¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æœ€åçš„ä¿¡æ¯è¿”å›æ•´ä¸ªåˆ—è¡¨å†…å®¹çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚

```py
>>> def make_mutable_rlist():
        """Return a functional implementation of a mutable recursive list."""
        contents = empty_rlist
        def dispatch(message, value=None):
            nonlocal contents
            if message == 'len':
                return len_rlist(contents)
            elif message == 'getitem':
                return getitem_rlist(contents, value)
            elif message == 'push_first':
                contents = make_rlist(value, contents)
            elif message == 'pop_first':
                f = first(contents)
                contents = rest(contents)
                return f
            elif message == 'str':
                return str(contents)
        return dispatch
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œæ¥ä»ä»»ä½•å†…å»ºåºåˆ—ä¸­æ„å»ºå‡½æ•°å¼å®ç°çš„é€’å½’åˆ—è¡¨ã€‚åªéœ€è¦ä»¥é€’å½’é¡ºåºæ·»åŠ æ¯ä¸ªå…ƒç´ ã€‚


```py
>>> def to_mutable_rlist(source):
        """Return a functional list with the same contents as source."""
        s = make_mutable_rlist()
        for element in reversed(source):
            s('push_first', element)
        return s
```

åœ¨ä¸Šé¢çš„å®šä¹‰ä¸­ï¼Œå‡½æ•°`reversed`æ¥å—å¹¶è¿”å›å¯è¿­ä»£å€¼ã€‚å®ƒæ˜¯ä½¿ç”¨åºåˆ—çš„æ¥å£çº¦å®šçš„å¦ä¸€ä¸ªç¤ºä¾‹ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å‡½æ•°å¼å®ç°çš„åˆ—è¡¨ï¼Œè¦æ³¨æ„åˆ—è¡¨è‡ªèº«ä¹Ÿæ˜¯ä¸ªå‡½æ•°ã€‚

```py
>>> s = to_mutable_rlist(suits)
>>> type(s)
<class 'function'>
>>> s('str')
"('heart', ('diamond', ('spade', ('club', None))))"
```

å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åƒåˆ—è¡¨`s`ä¼ é€’ä¿¡æ¯æ¥ä¿®æ”¹å®ƒçš„å†…å®¹ï¼Œæ¯”å¦‚ç§»é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚

```py
>>> s('pop_first')
'heart'
>>> s('str')
"('diamond', ('spade', ('club', None)))"
```

åŸåˆ™ä¸Šï¼Œæ“ä½œ`push_first`å’Œ`pop_first`è¶³ä»¥å¯¹åˆ—è¡¨åšä»»æ„ä¿®æ”¹ã€‚æˆ‘ä»¬æ€»æ˜¯å¯ä»¥æ¸…ç©ºæ•´ä¸ªåˆ—è¡¨ï¼Œä¹‹åå°†å®ƒæ—§çš„å†…å®¹æ›¿æ¢ä¸ºæƒ³è¦çš„ç»“æœã€‚

**æ¶ˆæ¯ä¼ é€’ã€‚**ç»™äºˆä¸€äº›æ—¶é—´ï¼Œæˆ‘ä»¬å°±èƒ½å®ç°è®¸å¤šå®ç”¨çš„ Python åˆ—è¡¨å¯å˜æ“ä½œï¼Œæ¯”å¦‚`extend`å’Œ`insert`ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªé€‰æ‹©ï¼šæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å…¨éƒ¨å®ç°ä¸ºå‡½æ•°ï¼Œè¿™ä¼šä½¿ç”¨ç°æœ‰çš„æ¶ˆæ¯`pop_first`å’Œ`push_first`æ¥å®ç°æ‰€æœ‰çš„æ”¹å˜æ“ä½œã€‚ä½œä¸ºä»£æ›¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘`dispatch`å‡½æ•°ä½“æ·»åŠ é¢å¤–çš„`elif`å­å¥ï¼Œæ¯ä¸ªå­å¥æ£€æŸ¥ä¸€ä¸ªæ¶ˆæ¯ï¼ˆä¾‹å¦‚`'extend'`ï¼‰ï¼Œå¹¶ä¸”ç›´æ¥åœ¨`contents`ä¸Šåšå‡ºåˆé€‚çš„æ”¹å˜ã€‚

ç¬¬äºŒä¸ªé€”å¾„å«åšæ¶ˆæ¯ä¼ é€’ï¼Œå®ƒæŠŠæ•°æ®å€¼ä¸Šé¢æ‰€æœ‰æ“ä½œçš„é€»è¾‘å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè¿™ä¸ªå‡½æ•°å“åº”ä¸åŒçš„æ¶ˆæ¯ã€‚ä¸€ä¸ªä½¿ç”¨æ¶ˆæ¯ä¼ é€’çš„ç¨‹åºå®šä¹‰äº†è°ƒåº¦å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æ‹¥æœ‰å±€éƒ¨çŠ¶æ€ï¼Œé€šè¿‡ä¼ é€’â€œæ¶ˆæ¯â€ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ç»™è¿™äº›å‡½æ•°æ¥ç»„ç»‡è®¡ç®—ã€‚æ¶ˆæ¯æ˜¯å¯¹åº”ç‰¹å®šè¡Œä¸ºçš„å­—ç¬¦ä¸²ã€‚

å¯ä»¥æƒ³è±¡ï¼Œåœ¨`dispatch`çš„å‡½æ•°ä½“ä¸­é€šè¿‡åç§°æ¥æšä¸¾æ‰€æœ‰è¿™äº›æ¶ˆæ¯éå¸¸æ— èŠï¼Œå¹¶ä¸”æ˜“äºå‡ºç°é”™è¯¯ã€‚Python çš„å­—å…¸æä¾›äº†ä¸€ç§æ•°æ®ç±»å‹ï¼Œä¼šå¸®åŠ©æˆ‘ä»¬ç®¡ç†æ¶ˆæ¯å’Œæ“ä½œä¹‹é—´çš„æ˜ å°„ï¼Œå®ƒä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­ä»‹ç»ã€‚

## 2.4.5 å­—å…¸

å­—å…¸æ˜¯ Python å†…å»ºæ•°æ®ç±»å‹ï¼Œç”¨äºå‚¨å­˜å’Œæ“ä½œå¯¹åº”å…³ç³»ã€‚å­—å…¸åŒ…å«äº†é”®å€¼å¯¹ï¼Œå…¶ä¸­é”®å’Œå€¼éƒ½å¯ä»¥æ˜¯å¯¹è±¡ã€‚å­—å…¸çš„ç›®çš„æ˜¯æä¾›ä¸€ç§æŠ½è±¡ï¼Œç”¨äºå‚¨å­˜å’Œè·å–ä¸‹æ ‡ä¸æ˜¯è¿ç»­æ•´æ•°ï¼Œè€Œæ˜¯æè¿°æ€§çš„é”®çš„å€¼ã€‚

å­—ç¬¦ä¸²é€šå¸¸ç”¨ä½œé”®ï¼Œå› ä¸ºå­—ç¬¦ä¸²é€šå¸¸ç”¨äºè¡¨ç¤ºäº‹ç‰©åç§°ã€‚è¿™ä¸ªå­—å…¸å­—é¢å€¼æä¾›äº†ä¸åŒç½—é©¬æ•°å­—çš„å€¼ã€‚

```py
>>> numerals = {'I': 1.0, 'V': 5, 'X': 10}
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…ƒç´ é€‰æ‹©è¿ç®—ç¬¦ï¼Œæ¥é€šè¿‡é”®æŸ¥æ‰¾å€¼ï¼Œæˆ‘ä»¬ä¹‹å‰å°†å…¶ç”¨äºåºåˆ—ã€‚

```py
>>> numerals['X']
10
```

å­—å…¸çš„æ¯ä¸ªé”®æœ€å¤šåªèƒ½æ‹¥æœ‰ä¸€ä¸ªå€¼ã€‚æ·»åŠ æ–°çš„é”®å€¼å¯¹æˆ–è€…ä¿®æ”¹æŸä¸ªé”®çš„å·²æœ‰å€¼ï¼Œå¯ä»¥ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦æ¥å®Œæˆã€‚

```py
>>> numerals['I'] = 1
>>> numerals['L'] = 50
>>> numerals
{'I': 1, 'X': 10, 'L': 50, 'V': 5}
```

è¦æ³¨æ„ï¼Œ`'L'`å¹¶æ²¡æœ‰æ·»åŠ åˆ°ä¸Šé¢è¾“å‡ºçš„æœ«å°¾ã€‚å­—å…¸æ˜¯æ— åºçš„é”®å€¼å¯¹é›†åˆã€‚å½“æˆ‘ä»¬æ‰“å°å­—å…¸æ—¶ï¼Œé”®å’Œå€¼éƒ½ä»¥æŸç§é¡ºåºæ¥æ¸²æŸ“ï¼Œä½†æ˜¯å¯¹è¯­è¨€çš„ç”¨æˆ·æ¥è¯´ï¼Œä¸åº”å‡è®¾é¡ºåºæ€»æ˜¯è¿™æ ·ã€‚

å­—å…¸æŠ½è±¡ä¹Ÿæ”¯æŒå¤šç§æ–¹æ³•ï¼Œæ¥ä»æ•´ä½“ä¸Šè¿­ä»£å­—å…¸ä¸­çš„å†…å®¹ã€‚æ–¹æ³•`keys`ã€`values`å’Œ`items`éƒ½è¿”å›å¯è¿­ä»£çš„å€¼ã€‚

```py
>>> sum(numerals.values())
66
```

é€šè¿‡è°ƒç”¨`dict`æ„é€ å‡½æ•°ï¼Œé”®å€¼å¯¹çš„åˆ—è¡¨å¯ä»¥è½¬æ¢ä¸ºå­—å…¸ã€‚

```py
>>> dict([(3, 9), (4, 16), (5, 25)])
{3: 9, 4: 16, 5: 25}
```

å­—å…¸ä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼š

+ å­—å…¸çš„é”®ä¸èƒ½æ˜¯å¯å˜å†…å»ºç±»å‹çš„å¯¹è±¡ã€‚
+ ä¸€ä¸ªç»™å®šçš„é”®æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå€¼ã€‚

ç¬¬ä¸€æ¡é™åˆ¶è¢«ç»‘å®šåˆ°äº† Python ä¸­å­—å…¸çš„åº•å±‚å®ç°ä¸Šã€‚è¿™ä¸ªå®ç°çš„ç»†èŠ‚å¹¶ä¸æ˜¯è¿™é—¨è¯¾çš„ä¸»é¢˜ã€‚ç›´è§‰ä¸Šï¼Œé”®å‘Šè¯‰äº† Python åº”è¯¥åœ¨å†…å­˜ä¸­çš„å“ªé‡Œå¯»æ‰¾é”®å€¼å¯¹ï¼›å¦‚æœé”®å‘ç”Ÿæ”¹å˜ï¼Œé”®å€¼å¯¹å°±ä¼šä¸¢å¤±ã€‚

ç¬¬äºŒä¸ªé™åˆ¶æ˜¯å­—å…¸æŠ½è±¡çš„ç»“æœï¼Œå®ƒä¸ºå‚¨å­˜å’Œè·å–æŸä¸ªé”®çš„å€¼è€Œè®¾è®¡ã€‚å¦‚æœå­—å…¸ä¸­æœ€å¤šåªå­˜åœ¨ä¸€ä¸ªè¿™æ ·çš„å€¼ï¼Œæˆ‘ä»¬åªèƒ½è·å–åˆ°æŸä¸ªé”®çš„ä¸€ä¸ªå€¼ã€‚

ç”±å­—å…¸å®ç°çš„ä¸€ä¸ªå®ç”¨æ–¹æ³•æ˜¯`get`ï¼Œå¦‚æœé”®å­˜åœ¨çš„è¯ï¼Œå®ƒè¿”å›é”®çš„å€¼ï¼Œå¦åˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚`get`çš„å‚æ•°æ˜¯é”®å’Œé»˜è®¤å€¼ã€‚

```py
>>> numerals.get('A', 0)
0
>>> numerals.get('V', 0)
5
```

å­—å…¸ä¹Ÿæ‹¥æœ‰æ¨å¯¼å¼è¯­æ³•ï¼Œå’Œåˆ—è¡¨å’Œç”Ÿæˆå™¨è¡¨è¾¾å¼ç±»ä¼¼ã€‚æ±‚è§£å­—å…¸æ¨å¯¼å¼ä¼šäº§ç”Ÿæ–°çš„å­—å…¸å¯¹è±¡ã€‚

```py
>>> {x: x*x for x in range(3,6)}
{3: 9, 4: 16, 5: 25}
```

**å®ç°ã€‚**æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªæŠ½è±¡æ•°æ®ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªè®°å½•çš„åˆ—è¡¨ï¼Œä¸å­—å…¸æŠ½è±¡ä¸€è‡´ã€‚æ¯ä¸ªè®°å½•éƒ½æ˜¯ä¸¤ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼ŒåŒ…å«é”®å’Œç›¸å…³çš„å€¼ã€‚

```py
>>> def make_dict():
        """Return a functional implementation of a dictionary."""
        records = []
        def getitem(key):
            for k, v in records:
                if k == key:
                    return v
        def setitem(key, value):
            for item in records:
                if item[0] == key:
                    item[1] = value
                    return
            records.append([key, value])
        def dispatch(message, key=None, value=None):
            if message == 'getitem':
                return getitem(key)
            elif message == 'setitem':
                setitem(key, value)
            elif message == 'keys':
                return tuple(k for k, _ in records)
            elif message == 'values':
                return tuple(v for _, v in records)
        return dispatch
```

åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¼ é€’æ–¹æ³•çš„æ¶ˆæ¯æ¥ç»„ç»‡æˆ‘ä»¬çš„å®ç°ã€‚æˆ‘ä»¬å·²ç»æ”¯æŒäº†å››ç§æ¶ˆæ¯ï¼š`getitem`ã€`setitem`ã€`keys`å’Œ`values`ã€‚è¦æŸ¥æ‰¾æŸä¸ªé”®çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿­ä»£è¿™äº›è®°å½•æ¥å¯»æ‰¾ä¸€ä¸ªåŒ¹é…çš„é”®ã€‚è¦æ’å…¥æŸä¸ªé”®çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿­ä»£æ•´ä¸ªè®°å½•æ¥è§‚å¯Ÿæ˜¯å¦å·²ç»å­˜åœ¨å¸¦æœ‰è¿™ä¸ªé”®çš„è®°å½•ã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬ä¼šæ„é€ ä¸€æ¡æ–°çš„è®°å½•ã€‚å¦‚æœå·²ç»æœ‰äº†å¸¦æœ‰è¿™ä¸ªé”®çš„è®°å½•ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè®°å½•çš„å€¼è®¾ä¸ºæ–°çš„å€¼ã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„å®ç°æ¥å‚¨å­˜å’Œè·å–å€¼ã€‚

```py
>>> d = make_dict()
>>> d('setitem', 3, 9)
>>> d('setitem', 4, 16)
>>> d('getitem', 3)
9
>>> d('getitem', 4)
16
>>> d('keys')
(3, 4)
>>> d('values')
(9, 16)
```

è¿™ä¸ªå­—å…¸å®ç°å¹¶ä¸ä¸ºå¿«é€Ÿçš„è®°å½•æ£€ç´¢è€Œä¼˜åŒ–ï¼Œå› ä¸ºæ¯ä¸ªå“åº”`getitem`æ¶ˆæ¯éƒ½å¿…é¡»è¿­ä»£æ•´ä¸ª`records`åˆ—è¡¨ã€‚å†…å»ºçš„å­—å…¸ç±»å‹æ›´åŠ é«˜æ•ˆã€‚

## 2.4.6 ç¤ºä¾‹ï¼šä¼ æ’­çº¦æŸ

å¯å˜æ•°æ®å…è®¸æˆ‘ä»¬æ¨¡æ‹Ÿå¸¦æœ‰å˜åŒ–çš„ç³»ç»Ÿï¼Œä¹Ÿå…è®¸æˆ‘ä»¬æ„å»ºæ–°çš„æŠ½è±¡ç±»å‹ã€‚åœ¨è¿™ä¸ªå»¶ä¼¸çš„å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬ç»„åˆäº†éå±€éƒ¨èµ‹å€¼ã€åˆ—è¡¨å’Œå­—å…¸æ¥æ„å»ºä¸€ä¸ªåŸºäºçº¦æŸçš„ç³»ç»Ÿï¼Œæ”¯æŒå¤šä¸ªæ–¹å‘ä¸Šçš„è®¡ç®—ã€‚å°†ç¨‹åºè¡¨è¾¾ä¸ºçº¦æŸæ˜¯ä¸€ç§å£°æ˜å¼ç¼–ç¨‹ï¼Œå…¶ä¸­ç¨‹åºå‘˜å£°æ˜éœ€è¦æ±‚è§£çš„é—®é¢˜ç»“æ„ï¼Œä½†æ˜¯æŠ½è±¡äº†é—®é¢˜è§£å†³æ–¹æ¡ˆå¦‚ä½•è®¡ç®—çš„ç»†èŠ‚ã€‚

è®¡ç®—æœºç¨‹åºé€šå¸¸ç»„ç»‡ä¸ºå•æ–¹å‘çš„è®¡ç®—ï¼Œå®ƒåœ¨é¢„å…ˆè®¾å®šçš„å‚æ•°ä¸Šæ‰§è¡Œæ“ä½œï¼Œæ¥äº§ç”Ÿåˆç†çš„è¾“å‡ºã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›æ ¹æ®æ•°é‡ä¸Šçš„å…³ç³»å¯¹ç³»ç»Ÿå»ºæ¨¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¹‹å‰è€ƒè™‘è¿‡ç†æƒ³æ°”ä½“å®šå¾‹ï¼Œå®ƒé€šè¿‡æ³¢å°”å…¹æ›¼å¸¸æ•°`k`å…³è”äº†ç†æƒ³æ°”ä½“çš„æ°”å‹`p`ï¼Œä½“ç§¯`v`ï¼Œæ•°é‡`n`ä»¥åŠæ¸©åº¦`t`ã€‚

```
p * v = n * k * t
```

è¿™æ ·ä¸€ä¸ªæ–¹ç¨‹å¹¶ä¸æ˜¯å•æ–¹å‘çš„ã€‚ç»™å®šä»»ä½•å››ä¸ªæ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹ç¨‹æ¥è®¡ç®—ç¬¬äº”ä¸ªã€‚ä½†å°†è¿™ä¸ªæ–¹ç¨‹ç¿»è¯‘ä¸ºæŸç§ä¼ ç»Ÿçš„è®¡ç®—æœºè¯­è¨€ä¼šå¼ºè¿«æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ•°é‡ï¼Œæ ¹æ®å…¶ä½™å››ä¸ªè®¡ç®—å‡ºæ¥ã€‚æ‰€ä»¥è®¡ç®—æ°”å‹çš„å‡½æ•°åº”è¯¥ä¸èƒ½ç”¨äºè®¡ç®—æ¸©åº¦ï¼Œå³ä½¿äºŒè€…çš„è®¡ç®—é€šè¿‡ç›¸åŒçš„æ–¹ç¨‹å®Œæˆã€‚

è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»é›¶å¼€å§‹è®¾è®¡çº¿æ€§è®¡ç®—çš„é€šç”¨æ¨¡å‹ã€‚æˆ‘ä»¬å®šä¹‰äº†æ•°é‡ä¹‹é—´çš„åŸºæœ¬çº¦æŸï¼Œä¾‹å¦‚`adder(a, b, c)`ä¼šä¸¥æ ¼ä¿è¯æ•°å­¦å…³ç³»`a + b = c`ã€‚

æˆ‘ä»¬ä¹Ÿå®šä¹‰äº†ç»„åˆçš„æ‰‹æ®µï¼Œä½¿åŸºæœ¬çº¦æŸå¯ä»¥è¢«ç»„åˆæ¥è¡¨è¾¾æ›´å¤æ‚çš„å…³ç³»ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬çš„ç¨‹åºå°±åƒä¸€ç§ç¼–ç¨‹è¯­è¨€ã€‚æˆ‘ä»¬é€šè¿‡æ„é€ ç½‘ç»œæ¥ç»„åˆçº¦æŸï¼Œå…¶ä¸­çº¦æŸç”±è¿æ¥å™¨è¿æ¥ã€‚è¿æ¥å™¨æ˜¯ä¸€ç§å¯¹è±¡ï¼Œå®ƒâ€œæŒæœ‰â€ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå‚ä¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¦æŸã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“åæ°å’Œæ‘„æ°æ¸©åº¦çš„å…³ç³»æ˜¯ï¼š

```
9 * c = 5 * (f - 32)
```

è¿™ä¸ªç­‰å¼æ˜¯`c`å’Œ`f`ä¹‹é—´çš„å¤æ‚çº¦æŸã€‚è¿™ç§çº¦æŸå¯ä»¥çœ‹åšåŒ…å«`adder`ã€`multiplier`å’Œ`contant`çº¦æŸçš„ç½‘ç»œã€‚

![](img/constraints.png)

è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå·¦è¾¹æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸‰ä¸ªç»ˆç«¯çš„ä¹˜æ³•å™¨ç›’å­ï¼Œæ ‡è®°ä¸º`a`ï¼Œ`b`å’Œ`c`ã€‚å®ƒä»¬å°†ä¹˜æ³•å™¨è¿æ¥åˆ°ç½‘ç»œå‰©ä½™çš„éƒ¨åˆ†ï¼šç»ˆç«¯`a`é“¾æ¥åˆ°äº†è¿æ¥å™¨`celsius`ä¸Šï¼Œå®ƒæŒæœ‰æ‘„æ°æ¸©åº¦ã€‚ç»ˆç«¯`b`é“¾æ¥åˆ°äº†è¿æ¥å™¨`w`ä¸Šï¼Œ`w`ä¹Ÿé“¾æ¥åˆ°æŒæœ‰`9`çš„ç›’å­ä¸Šã€‚ç»ˆç«¯`c`ï¼Œè¢«ä¹˜æ³•å™¨ç›’å­çº¦æŸä¸º`a`å’Œ`b`çš„ä¹˜ç§¯ï¼Œé“¾æ¥åˆ°å¦ä¸€ä¸ªä¹˜æ³•å™¨ç›’å­ä¸Šï¼Œå®ƒçš„`b`é“¾æ¥åˆ°å¸¸æ•°`5`ä¸Šï¼Œä»¥åŠå®ƒçš„`a`è¿æ¥åˆ°äº†æ±‚å’Œçº¦æŸçš„ä¸€é¡¹ä¸Šã€‚

è¿™ä¸ªç½‘ç»œä¸Šçš„è®¡ç®—ä¼šå¦‚ä¸‹è¿›è¡Œï¼šå½“è¿æ¥å™¨è¢«æä¾›ä¸€ä¸ªå€¼æ—¶ï¼ˆè¢«ç”¨æˆ·æˆ–è¢«é“¾æ¥åˆ°å®ƒçš„çº¦æŸå™¨ï¼‰ï¼Œå®ƒä¼šå”¤é†’æ‰€æœ‰ç›¸å…³çš„çº¦æŸï¼ˆé™¤äº†åˆšåˆšå”¤é†’çš„çº¦æŸï¼‰æ¥é€šçŸ¥å®ƒä»¬å®ƒå¾—åˆ°äº†ä¸€ä¸ªå€¼ã€‚æ¯ä¸ªå”¤é†’çš„çº¦æŸä¹‹åä¼šè°ƒæŸ¥å®ƒçš„è¿æ¥å™¨ï¼Œæ¥çœ‹çœ‹æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥ä¸ºè¿æ¥å™¨æ±‚å‡ºä¸€ä¸ªå€¼ã€‚å¦‚æœå¯ä»¥ï¼Œç›’å­ä¼šè®¾ç½®è¿™ä¸ªè¿æ¥å™¨ï¼Œè¿æ¥å™¨ä¹‹åä¼šå”¤é†’æ‰€æœ‰ç›¸å…³çš„çº¦æŸï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æ‘„æ°æ¸©åº¦å’Œåæ°æ¸©åº¦çš„è½¬æ¢ä¸­ï¼Œ`w`ã€`x`å’Œ`y`ä¼šè¢«å¸¸é‡ç›’å­`9`ã€`5`å’Œ`32`ç«‹å³è®¾ç½®ã€‚è¿æ¥å™¨ä¼šå”¤é†’ä¹˜æ³•å™¨å’ŒåŠ æ³•å™¨ï¼Œå®ƒä»¬åˆ¤æ–­å‡ºæ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯ç”¨äºå¤„ç†ã€‚å¦‚æœç”¨æˆ·ï¼ˆæˆ–è€…ç½‘ç»œçš„å…¶å®ƒéƒ¨åˆ†ï¼‰å°†`celsis`è¿æ¥å™¨è®¾ç½®ä¸ºæŸä¸ªå€¼ï¼ˆæ¯”å¦‚`25`ï¼‰ï¼Œæœ€å·¦è¾¹çš„ä¹˜æ³•å™¨ä¼šè¢«å”¤é†’ï¼Œä¹‹åå®ƒä¼šå°†`u`è®¾ç½®ä¸º`25 * 9 = 225`ã€‚ä¹‹å`u`ä¼šå”¤é†’ç¬¬äºŒä¸ªä¹˜æ³•å™¨ï¼Œå®ƒä¼šå°†`v`è®¾ç½®ä¸º`45`ï¼Œä¹‹å`v`ä¼šå”¤é†’åŠ æ³•å™¨ï¼Œå®ƒå°†`fahrenheit`è¿æ¥å™¨è®¾ç½®ä¸º`77`ã€‚

**ä½¿ç”¨çº¦æŸç³»ç»Ÿã€‚**ä¸ºäº†ä½¿ç”¨çº¦æŸç³»ç»Ÿæ¥è®¡ç®—å‡ºä¸Šé¢æ‰€æè¿°çš„æ¸©åº¦è®¡ç®—ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸¤ä¸ªå…·åè¿æ¥å™¨ï¼Œ`celsius`å’Œ`fahrenheit`ï¼Œé€šè¿‡è°ƒç”¨`make_connector`æ„é€ å™¨ã€‚

```py
>>> celsius = make_connector('Celsius')
>>> fahrenheit = make_connector('Fahrenheit')
```

ä¹‹åï¼Œæˆ‘ä»¬å°†è¿™äº›è¿æ¥å™¨é“¾æ¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™ä¸ªç½‘ç»œåæ˜ äº†ä¸Šé¢çš„å›¾ç¤ºã€‚å‡½æ•°`make_converter`ç»„è£…äº†ç½‘ç»œä¸­ä¸åŒçš„è¿æ¥å™¨å’Œçº¦æŸï¼š

```py
>>> def make_converter(c, f):
        """Connect c to f with constraints to convert from Celsius to Fahrenheit."""
        u, v, w, x, y = [make_connector() for _ in range(5)]
        multiplier(c, w, u)
        multiplier(v, x, u)
        adder(v, y, f)
        constant(w, 9)
        constant(x, 5)
        constant(y, 32)
>>> make_converter(celsius, fahrenheit)
```

æˆ‘ä»¬ä¼šä½¿ç”¨æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿæ¥åè°ƒçº¦æŸå’Œè¿æ¥å™¨ã€‚æˆ‘ä»¬ä¸ä¼šä½¿ç”¨å‡½æ•°æ¥å“åº”æ¶ˆæ¯ï¼Œè€Œæ˜¯ä½¿ç”¨å­—å…¸ã€‚ç”¨äºåˆ†å‘çš„å­—å…¸æ‹¥æœ‰å­—ç¬¦ä¸²ç±»å‹çš„é”®ï¼Œä»£è¡¨å®ƒæ¥å—çš„æ¶ˆæ¯ã€‚è¿™äº›é”®å…³è”çš„å€¼æ˜¯è¿™äº›æ¶ˆæ¯çš„å“åº”ã€‚

çº¦æŸæ˜¯ä¸å¸¦æœ‰å±€éƒ¨çŠ¶æ€çš„å­—å…¸ã€‚å®ƒä»¬å¯¹æ¶ˆæ¯çš„å“åº”æ˜¯éçº¯å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¼šæ”¹å˜æ‰€çº¦æŸçš„è¿æ¥å™¨ã€‚

è¿æ¥å™¨æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒæŒæœ‰å½“å‰å€¼å¹¶å“åº”æ“ä½œè¯¥å€¼çš„æ¶ˆæ¯ã€‚çº¦æŸä¸ä¼šç›´æ¥æ”¹å˜è¿æ¥å™¨çš„å€¼ï¼Œè€Œæ˜¯ä¼šé€šè¿‡å‘é€æ¶ˆæ¯æ¥æ”¹å˜ï¼Œäºæ˜¯è¿æ¥å™¨å¯ä»¥æé†’å…¶ä»–çº¦æŸæ¥å“åº”å˜åŒ–ã€‚è¿™æ ·ï¼Œè¿æ¥å™¨ä»£è¡¨äº†ä¸€ä¸ªæ•°å€¼ï¼ŒåŒæ—¶å°è£…äº†è¿æ¥å™¨çš„è¡Œä¸ºã€‚

æˆ‘ä»¬å¯ä»¥å‘é€ç»™è¿æ¥å™¨çš„ä¸€ç§æ¶ˆæ¯æ˜¯è®¾ç½®å®ƒçš„å€¼ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ï¼ˆ`'user'`ï¼‰å°†`celsius`çš„å€¼è®¾ç½®ä¸º`25`ã€‚

```py
>>> celsius['set_val']('user', 25)
Celsius = 25
Fahrenheit = 77.0
```

ä¸ä»…ä»…æ˜¯`celsius`çš„å€¼å˜æˆäº†`25`ï¼Œå®ƒçš„å€¼ä¹Ÿåœ¨ç½‘ç»œä¸Šä¼ æ’­ï¼Œäºæ˜¯`fahrenheit`çš„å€¼ä¹Ÿå‘ç”Ÿå˜åŒ–ã€‚è¿™äº›å˜åŒ–æ‰“å°äº†å‡ºæ¥ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ„é€ è¿™ä¸¤ä¸ªè¿æ¥å™¨çš„æ—¶å€™å‘½åäº†å®ƒä»¬ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¯•ç€å°†`fahrenheit`è®¾ç½®ä¸ºæ–°çš„å€¼ï¼Œæ¯”å¦‚`212`ã€‚

```py
>>> fahrenheit['set_val']('user', 212)
Contradiction detected: 77.0 vs 212
```

è¿æ¥å™¨æŠ¥å‘Šè¯´ï¼Œå®ƒå¯Ÿè§‰åˆ°äº†ä¸€ä¸ªçŸ›ç›¾ï¼šå®ƒçš„å€¼æ˜¯`77.0`ï¼Œä½†æ˜¯æœ‰äººå°è¯•å°†å…¶è®¾ç½®ä¸º`212`ã€‚å¦‚æœæˆ‘ä»¬çœŸçš„æƒ³ä»¥æ–°çš„å€¼å¤ç”¨è¿™ä¸ªç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥è®©`celsius`å¿˜æ‰æ—§çš„å€¼ã€‚

```py
>>> celsius['forget']('user')
Celsius is forgotten
Fahrenheit is forgotten
```

è¿æ¥å™¨`celsius`å‘ç°äº†`user`ï¼Œä¸€å¼€å§‹è®¾ç½®äº†å®ƒçš„å€¼ï¼Œç°åœ¨åˆæƒ³æ’¤é”€è¿™ä¸ªå€¼ï¼Œæ‰€ä»¥`celsius`åŒæ„ä¸¢æ‰è¿™ä¸ªå€¼ï¼Œå¹¶ä¸”é€šçŸ¥äº†ç½‘ç»œçš„å…¶ä½™éƒ¨åˆ†ã€‚è¿™ä¸ªæ¶ˆæ¯æœ€ç»ˆä¼ æ’­ç»™`fahrenheit`ï¼Œå®ƒç°åœ¨å‘ç°æ²¡æœ‰ç†ç”±ç»§ç»­ç›¸ä¿¡è‡ªå·±çš„å€¼ä¸º`77`ã€‚äºæ˜¯ï¼Œå®ƒä¹Ÿä¸¢æ‰äº†å®ƒçš„å€¼ã€‚

ç°åœ¨`fahrenheit`æ²¡æœ‰å€¼äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶è®¾ç½®ä¸º`212`ï¼š

```py
>>> fahrenheit['set_val']('user', 212)
Fahrenheit = 212
Celsius = 100.0
```

è¿™ä¸ªæ–°å€¼åœ¨ç½‘ç»œä¸Šä¼ æ’­ï¼Œå¹¶å¼ºè¿«`celsius`æŒæœ‰å€¼`100`ã€‚æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†éå¸¸ç›¸ä¼¼çš„ç½‘ç»œï¼Œæä¾›`fahrenheit`æ¥è®¡ç®—`celsius`ï¼Œä»¥åŠæä¾›`celsius`æ¥è®¡ç®—`fahrenheit`ã€‚è¿™ä¸ªæ— æ–¹å‘çš„è®¡ç®—å°±æ˜¯åŸºäºçº¦æŸçš„ç½‘ç»œçš„ç‰¹å¾ã€‚

**å®ç°çº¦æŸç³»ç»Ÿã€‚**åƒæˆ‘ä»¬çœ‹åˆ°çš„é‚£æ ·ï¼Œè¿æ¥å™¨æ˜¯å­—å…¸ï¼Œå°†æ¶ˆæ¯åç§°æ˜ å°„ä¸ºå‡½æ•°å’Œæ•°æ®å€¼ã€‚æˆ‘ä»¬å°†è¦å®ç°å“åº”ä¸‹åˆ—æ¶ˆæ¯çš„è¿æ¥å™¨ï¼š

+ `connector['set_val'](source, value)` è¡¨ç¤º`source`è¯·æ±‚è¿æ¥å™¨å°†å½“å‰å€¼è®¾ç½®ä¸ºè¯¥å€¼ã€‚
+ `connector['has_val']()` è¿”å›è¿æ¥å™¨æ˜¯å¦å·²ç»æœ‰äº†ä¸€ä¸ªå€¼ã€‚
+ `connector['val']` æ˜¯è¿æ¥å™¨çš„å½“å‰å€¼ã€‚
+ `connector['forget'](source)` å‘Šè¯‰è¿æ¥å™¨ï¼Œ`source`è¯·æ±‚å®ƒå¿˜æ‰å½“å‰å€¼ã€‚
+ `connector['connect'](source)` å‘Šè¯‰è¿æ¥å™¨å‚ä¸æ–°çš„çº¦æŸ`source`ã€‚

çº¦æŸä¹Ÿæ˜¯å­—å…¸ï¼Œæ¥å—æ¥è‡ªè¿æ¥å™¨çš„ä»¥ä¸‹ä¸¤ç§æ¶ˆæ¯ï¼š

+ `constraint['new_val']()` è¡¨ç¤ºè¿æ¥åˆ°çº¦æŸçš„è¿æ¥å™¨æœ‰äº†æ–°çš„å€¼ã€‚
+ `constraint['forget']()` è¡¨ç¤ºè¿æ¥åˆ°çº¦æŸçš„è¿æ¥å™¨éœ€è¦å¿˜æ‰å®ƒçš„å€¼ã€‚

å½“çº¦æŸæ”¶åˆ°è¿™äº›æ¶ˆæ¯æ—¶ï¼Œå®ƒä»¬é€‚å½“åœ°å°†å®ƒä»¬ä¼ æ’­ç»™å…¶å®ƒè¿æ¥å™¨ã€‚

`adder`å‡½æ•°åœ¨ä¸¤ä¸ªè¿æ¥å™¨ä¸Šæ„é€ äº†åŠ æ³•å™¨çº¦æŸï¼Œå…¶ä¸­å‰ä¸¤ä¸ªè¿æ¥å™¨å¿…é¡»åŠ åˆ°ç¬¬ä¸‰ä¸ªä¸Šï¼š`a + b = c`ã€‚ä¸ºäº†æ”¯æŒå¤šæ–¹å‘çš„çº¦æŸä¼ æ’­ï¼ŒåŠ æ³•å™¨å¿…é¡»ä¹Ÿè§„å®šä»`c`ä¸­å‡å»`a`ä¼šå¾—åˆ°`b`ï¼Œæˆ–è€…ä»`c`ä¸­å‡å»`b`ä¼šå¾—åˆ°`a`ã€‚

```py
>>> from operator import add, sub
>>> def adder(a, b, c):
        """The constraint that a + b = c."""
        return make_ternary_constraint(a, b, c, add, sub, sub)
```

æˆ‘ä»¬å¸Œæœ›å®ç°ä¸€ä¸ªé€šç”¨çš„ä¸‰å…ƒï¼ˆä¸‰ä¸ªæ–¹å‘ï¼‰çº¦æŸï¼Œå®ƒä½¿ç”¨ä¸‰ä¸ªè¿æ¥å™¨å’Œä¸‰ä¸ªå‡½æ•°æ¥åˆ›å»ºçº¦æŸï¼Œæ¥å—`new_val`å’Œ`forget`æ¶ˆæ¯ã€‚æ¶ˆæ¯çš„å“åº”æ˜¯å±€éƒ¨å‡½æ•°ï¼Œå®ƒæ”¾åœ¨å«åš`constraint`çš„å­—å…¸ä¸­ã€‚


```py
>>> def make_ternary_constraint(a, b, c, ab, ca, cb):
        """The constraint that ab(a,b)=c and ca(c,a)=b and cb(c,b) = a."""
        def new_value():
            av, bv, cv = [connector['has_val']() for connector in (a, b, c)]
            if av and bv:
                c['set_val'](constraint, ab(a['val'], b['val']))
            elif av and cv:
                b['set_val'](constraint, ca(c['val'], a['val']))
            elif bv and cv:
                a['set_val'](constraint, cb(c['val'], b['val']))
        def forget_value():
            for connector in (a, b, c):
                connector['forget'](constraint)
        constraint = {'new_val': new_value, 'forget': forget_value}
        for connector in (a, b, c):
            connector['connect'](constraint)
        return constraint
```

å«åš`constraint`çš„å­—å…¸æ˜¯ä¸ªåˆ†å‘å­—å…¸ï¼Œä¹Ÿæ˜¯çº¦æŸå¯¹è±¡è‡ªèº«ã€‚å®ƒå“åº”ä¸¤ç§çº¦æŸæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œä¹Ÿåœ¨å¯¹è¿æ¥å™¨çš„è°ƒç”¨ä¸­ä½œä¸º`source`å‚æ•°ä¼ é€’ã€‚

æ— è®ºçº¦æŸä»€ä¹ˆæ—¶å€™è¢«é€šçŸ¥ï¼Œå®ƒçš„è¿æ¥å™¨ä¹‹ä¸€æ‹¥æœ‰äº†å€¼ï¼Œçº¦æŸçš„å±€éƒ¨å‡½æ•°`new_value`éƒ½ä¼šè¢«è°ƒç”¨ã€‚è¿™ä¸ªå‡½æ•°é¦–å…ˆæ£€æŸ¥æ˜¯å¦`a`å’Œ`b`éƒ½æ‹¥æœ‰å€¼ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œå®ƒå‘Šè¯‰`c`å°†å€¼è®¾ä¸ºå‡½æ•°`ab`çš„è¿”å›å€¼ï¼Œåœ¨`adder`ä¸­æ˜¯`add`ã€‚çº¦æŸï¼Œä¹Ÿå°±æ˜¯`adder`å¯¹è±¡ï¼Œå°†è‡ªèº«ä½œä¸º`source`å‚æ•°ä¼ é€’ç»™è¿æ¥å™¨ã€‚å¦‚æœ`a`å’Œ`b`ä¸åŒæ—¶æ‹¥æœ‰å€¼ï¼Œçº¦æŸä¼šæ£€æŸ¥`a`å’Œ`c`ï¼Œä»¥æ­¤ç±»æ¨ã€‚

å¦‚æœçº¦æŸè¢«é€šçŸ¥ï¼Œè¿æ¥å™¨ä¹‹ä¸€å¿˜æ‰äº†å®ƒçš„å€¼ï¼Œå®ƒä¼šè¯·æ±‚æ‰€æœ‰è¿æ¥å™¨å¿˜æ‰å®ƒä»¬çš„å€¼ï¼ˆåªæœ‰ç”±çº¦æŸè®¾ç½®çš„å€¼ä¼šè¢«çœŸæ­£ä¸¢æ‰ï¼‰ã€‚

`multiplier`ä¸`adder`ç±»ä¼¼ï¼š

```py
>>> from operator import mul, truediv
>>> def multiplier(a, b, c):
        """The constraint that a * b = c."""
        return make_ternary_constraint(a, b, c, mul, truediv, truediv)
```

å¸¸é‡ä¹Ÿæ˜¯çº¦æŸï¼Œä½†æ˜¯å®ƒä¸ä¼šå‘é€ä»»ä½•æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒåªåŒ…å«ä¸€ä¸ªå•ä¸€çš„è¿æ¥å™¨ï¼Œåœ¨æ„é€ çš„æ—¶å€™ä¼šè®¾ç½®å®ƒã€‚

```py
>>> def constant(connector, value):
        """The constraint that connector = value."""
        constraint = {}
        connector['set_val'](constraint, value)
        return constraint
```

è¿™ä¸‰ä¸ªçº¦æŸè¶³ä»¥å®ç°æˆ‘ä»¬çš„æ¸©åº¦è½¬æ¢ç½‘ç»œã€‚

**è¡¨ç¤ºè¿æ¥å™¨ã€‚**è¿æ¥å™¨è¡¨ç¤ºä¸ºåŒ…å«ä¸€ä¸ªå€¼çš„å­—å…¸ï¼Œä½†æ˜¯åŒæ—¶æ‹¥æœ‰å¸¦æœ‰å±€éƒ¨çŠ¶æ€çš„å“åº”å‡½æ•°ã€‚è¿æ¥å™¨å¿…é¡»è·Ÿè¸ªå‘å®ƒæä¾›å½“å‰å€¼çš„`informant`ï¼Œä»¥åŠå®ƒæ‰€å‚ä¸çš„`constraints`åˆ—è¡¨ã€‚

æ„é€ å™¨`make_connector`æ˜¯å±€éƒ¨å‡½æ•°ï¼Œç”¨äºè®¾ç½®å’Œå¿˜æ‰å€¼ï¼Œå®ƒå“åº”æ¥è‡ªçº¦æŸçš„æ¶ˆæ¯ã€‚

```py
>>> def make_connector(name=None):
        """A connector between constraints."""
        informant = None
        constraints = []
        def set_value(source, value):
            nonlocal informant
            val = connector['val']
            if val is None:
                informant, connector['val'] = source, value
                if name is not None:
                    print(name, '=', value)
                inform_all_except(source, 'new_val', constraints)
            else:
                if val != value:
                    print('Contradiction detected:', val, 'vs', value)
        def forget_value(source):
            nonlocal informant
            if informant == source:
                informant, connector['val'] = None, None
                if name is not None:
                    print(name, 'is forgotten')
                inform_all_except(source, 'forget', constraints)
        connector = {'val': None,
                     'set_val': set_value,
                     'forget': forget_value,
                     'has_val': lambda: connector['val'] is not None,
                     'connect': lambda source: constraints.append(source)}
        return connector
```

åŒæ—¶ï¼Œè¿æ¥å™¨æ˜¯ä¸€ä¸ªåˆ†å‘å­—å…¸ï¼Œç”¨äºåˆ†å‘äº”ä¸ªæ¶ˆæ¯ï¼Œçº¦æŸä½¿ç”¨å®ƒä»¬æ¥å’Œè¿æ¥å™¨é€šä¿¡ã€‚å‰å››ä¸ªå“åº”éƒ½æ˜¯å‡½æ•°ï¼Œæœ€åä¸€ä¸ªå“åº”å°±æ˜¯å€¼æœ¬èº«ã€‚

å±€éƒ¨å‡½æ•°`set_value`åœ¨è¯·æ±‚è®¾ç½®è¿æ¥å™¨çš„å€¼æ—¶è¢«è°ƒç”¨ã€‚å¦‚æœè¿æ¥å™¨å½“å‰å¹¶æ²¡æœ‰å€¼ï¼Œå®ƒä¼šè®¾ç½®è¯¥å€¼å¹¶å°†`informant`è®°ä¸ºè¯·æ±‚è®¾ç½®è¯¥å€¼çš„`source`çº¦æŸã€‚ä¹‹åè¿æ¥å™¨ä¼šæé†’æ‰€æœ‰å‚ä¸çš„çº¦æŸï¼Œé™¤äº†è¯·æ±‚è®¾ç½®è¯¥å€¼çš„çº¦æŸã€‚è¿™é€šè¿‡ä½¿ç”¨ä¸‹åˆ—è¿­ä»£å‡½æ•°æ¥å®Œæˆã€‚

```py
>>> def inform_all_except(source, message, constraints):
        """Inform all constraints of the message, except source."""
        for c in constraints:
            if c != source:
                c[message]()
```

å¦‚æœä¸€ä¸ªè¿æ¥å™¨è¢«è¯·æ±‚å¿˜æ‰å®ƒçš„å€¼ï¼Œå®ƒä¼šè°ƒç”¨å±€éƒ¨å‡½æ•°`forget_value`ï¼Œè¿™ä¸ªå‡½æ•°é¦–å…ˆæ‰§è¡Œæ£€æŸ¥ï¼Œæ¥ç¡®ä¿è¯·æ±‚æ¥è‡ªä¹‹å‰è®¾ç½®è¯¥å€¼çš„åŒä¸€ä¸ªçº¦æŸã€‚å¦‚æœæ˜¯çš„è¯ï¼Œè¿æ¥å™¨é€šçŸ¥ç›¸å…³çš„çº¦æŸæ¥ä¸¢æ‰å½“å‰å€¼ã€‚

å¯¹`has_val`æ¶ˆæ¯çš„å“åº”è¡¨ç¤ºè¿æ¥å™¨æ˜¯å¦æ‹¥æœ‰ä¸€ä¸ªå€¼ã€‚å¯¹`connect`æ¶ˆæ¯çš„å“åº”å°†`source`çº¦æŸæ·»åŠ åˆ°çº¦æŸåˆ—è¡¨ä¸­ã€‚

æˆ‘ä»¬è®¾è®¡çš„çº¦æŸç¨‹åºå¼•å…¥äº†è®¸å¤šå‡ºç°åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ¦‚å¿µã€‚çº¦æŸå’Œè¿æ¥å™¨éƒ½æ˜¯æŠ½è±¡ï¼Œå®ƒä»¬é€šè¿‡æ¶ˆæ¯æ¥æ“ä½œã€‚å½“è¿æ¥å™¨çš„å€¼ç”±æ¶ˆæ¯æ”¹å˜æ—¶ï¼Œæ¶ˆæ¯ä¸ä»…ä»…æ”¹å˜äº†å®ƒçš„å€¼ï¼Œè¿˜å¯¹å…¶éªŒè¯ï¼ˆæ£€æŸ¥æ¥æºï¼‰å¹¶ä¼ æ’­å®ƒçš„å½±å“ã€‚å®é™…ä¸Šï¼Œåœ¨è¿™ä¸€ç« çš„åé¢ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç›¸ä¼¼çš„å­—ç¬¦ä¸²å€¼çš„å­—å…¸ç»“æ„å’Œå‡½æ•°å€¼æ¥å®ç°é¢å‘å¯¹è±¡ç³»ç»Ÿã€‚
